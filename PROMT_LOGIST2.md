# –ü–û–õ–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê LOGIST2

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 14 —Ñ–µ–≤—Ä–∞–ª—è 2026
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏

---

## üìã –û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

**–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:** Logist2 (Caromoto Lithuania)  
**–¢–∏–ø:** Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏  
**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ä—Å–∫–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –¢–°, —Å–∫–ª–∞–¥–∞–º–∏, –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∏–Ω–≤–æ–π—Å–∞–º–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| Backend | Django 5.1.7, Python 3.10-3.12 |
| API | Django REST Framework + Rate Limiting (throttles) |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | PostgreSQL (—Ç–µ—Å—Ç—ã ‚Äî SQLite –≤ `settings_test.py`) |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | Redis (db=1) –Ω–∞ production –∏ –ª–æ–∫–∞–ª—å–Ω–æ (—Å fallback –Ω–∞ FileBasedCache) |
| –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á | Celery + Redis (db=2) ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email |
| Web-—Å–µ—Ä–≤–µ—Ä | Nginx + Gunicorn, —Å—Ç–∞—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ WhiteNoise |
| WebSockets | Django Channels + Daphne (Redis –≤ `settings_base.py`, InMemory –≤ `settings.py`) |
| –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | HTMX + –∫–∞—Å—Ç–æ–º–Ω—ã–π JS |
| UI —Å–∞–π—Ç–∞ | Bootstrap 5 |
| Email | Brevo (SMTP), –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Celery –∑–∞–¥–∞—á–∏ |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ | Google Drive API, Revolut Business API, site.pro Accounting API |

### –°–µ—Ä–≤–µ—Ä

- **IP:** 176.118.198.78
- **–î–æ–º–µ–Ω:** https://caromoto-lt.com
- **–ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:** `/var/www/www-root/data/www/logist2`

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –ò–ï–†–ê–†–•–ò–Ø –î–ê–ù–ù–´–•

### –ì–ª–∞–≤–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è

```
–ö–û–ù–¢–ï–ô–ù–ï–† (Container) ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, "—Ä–æ–¥–∏—Ç–µ–ª—å"
    ‚îÇ
    ‚îú‚îÄ‚îÄ –ú–æ—Ä—Å–∫–∞—è –ª–∏–Ω–∏—è (Line)
    ‚îú‚îÄ‚îÄ –°–∫–ª–∞–¥ (Warehouse)
    ‚îú‚îÄ‚îÄ THS (—Å—É–º–º–∞ –æ–ø–ª–∞—Ç—ã –ª–∏–Ω–∏—è–º –∑–∞ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
    ‚îÇ
    ‚îî‚îÄ‚îÄ –ê–í–¢–û–ú–û–ë–ò–õ–ò (Car) ‚Äî "–¥–µ—Ç–∏", –Ω–∞—Å–ª–µ–¥—É—é—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            ‚îÇ
            ‚îú‚îÄ‚îÄ –ö–ª–∏–µ–Ω—Ç (Client) ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –¢–°
            ‚îú‚îÄ‚îÄ –ü–µ—Ä–µ–≤–æ–∑—á–∏–∫ (Carrier) ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ –¢–° –ø–æ—Å–ª–µ —Ä–∞–∑–≥—Ä—É–∑–∫–∏
            ‚îÇ
            ‚îî‚îÄ‚îÄ –£–°–õ–£–ì–ò (CarService) ‚Äî —Å–≤—è–∑—å –¢–° —Å —É—Å–ª—É–≥–∞–º–∏
                    ‚îú‚îÄ‚îÄ –£—Å–ª—É–≥–∏ –ª–∏–Ω–∏–∏ (LINE) ‚Äî –≤–∫–ª—é—á–∞—è THS
                    ‚îú‚îÄ‚îÄ –£—Å–ª—É–≥–∏ —Å–∫–ª–∞–¥–∞ (WAREHOUSE) ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Ä–∞–∑–≥—Ä—É–∑–∫–∞ –∏ –¥—Ä.
                    ‚îú‚îÄ‚îÄ –£—Å–ª—É–≥–∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ (CARRIER)
                    ‚îî‚îÄ‚îÄ –£—Å–ª—É–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏ (COMPANY)
```

### –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–í–ê–ñ–ù–û:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –¢–° –≤–Ω—É—Ç—Ä–∏:

| –ü–æ–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ | –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –≤ –¢–° | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------------|------------------|------------|
| `status` | ‚úÖ –î–∞ | –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –¢–° |
| `warehouse` | ‚úÖ –î–∞ | –°–∫–ª–∞–¥ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Å–µ –¢–° |
| `unload_date` | ‚úÖ –î–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ) | –î–∞—Ç–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –í–°–ï–ì–î–ê –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è |
| `line` | ‚úÖ –î–∞ | –õ–∏–Ω–∏—è –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Å–µ –¢–° |
| `ths` | ‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è | THS —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ —Ç–∏–ø–∞–º –¢–° |

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ö–æ–≥–¥–∞ –í–°–ï –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ–ª—É—á–∞—é—Ç —Å—Ç–∞—Ç—É—Å "–ü–µ—Ä–µ–¥–∞–Ω" ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–æ–∂–µ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "–ü–µ—Ä–µ–¥–∞–Ω".

---

## üì¶ –ú–û–î–ï–õ–ò –î–ê–ù–ù–´–•

### Container (–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä)

```python
# –§–∞–π–ª: core/models.py

Container:
    number              # –ù–æ–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
    status              # FLOATING (–í –ø—É—Ç–∏), IN_PORT (–í –ø–æ—Ä—Ç—É), UNLOADED (–†–∞–∑–≥—Ä—É–∂–µ–Ω), TRANSFERRED (–ü–µ—Ä–µ–¥–∞–Ω)
    line                # FK ‚Üí Line (–ú–æ—Ä—Å–∫–∞—è –ª–∏–Ω–∏—è)
    warehouse           # FK ‚Üí Warehouse (–°–∫–ª–∞–¥ —Ä–∞–∑–≥—Ä—É–∑–∫–∏)
    client              # FK ‚Üí Client (–∫–ª–∏–µ–Ω—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
    customs_procedure   # –¢–∞–º–æ–∂–µ–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ (TRANSIT/IMPORT/REEXPORT/EXPORT)
    
    # THS —Å–∏—Å—Ç–µ–º–∞
    ths                 # Decimal ‚Äî –æ–±—â–∞—è —Å—É–º–º–∞ THS –∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    ths_payer           # LINE –∏–ª–∏ WAREHOUSE ‚Äî –∫–æ–º—É –∑–∞–ø–∏—Å–∞—Ç—å —Ä–∞—Å—Ö–æ–¥ THS
    sklad               # –û–ø–ª–∞—Ç–∞ —Å–∫–ª–∞–¥—É (legacy –ø–æ–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
    dekl                # –î–µ–∫–ª–∞—Ä–∞—Ü–∏—è (legacy –ø–æ–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
    proft               # –ù–∞—Ü–µ–Ω–∫–∞ (legacy –ø–æ–ª–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
    
    # –î–∞—Ç—ã
    eta                 # –û–∂–∏–¥–∞–µ–º–∞—è –¥–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è
    planned_unload_date # "–ë—É–¥–µ–º —Ä–∞–∑–≥—Ä—É–∂–∞—Ç—å" ‚Äî –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email –∫–ª–∏–µ–Ω—Ç–∞–º
    unload_date         # –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏ ‚Äî –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email
    unloaded_status_at  # –ö–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—É—á–∏–ª —Å—Ç–∞—Ç—É—Å "–†–∞–∑–≥—Ä—É–∂–µ–Ω"
    
    # –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (legacy —Ä–∞—Å—á—ë—Ç)
    free_days           # –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏
    days                # –ü–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏
    rate                # –°—Ç–∞–≤–∫–∞ (legacy)
    storage_cost        # –°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è (legacy)
    notes               # –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
    
    # Google Drive
    google_drive_folder_url  # –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–ø–∫—É —Å —Ñ–æ—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "–†–∞–∑–≥—Ä—É–∂–µ–Ω" –ø–æ–ª—è `warehouse` –∏ `unload_date` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.

### Car (–ê–≤—Ç–æ–º–æ–±–∏–ª—å/–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ)

```python
# –§–∞–π–ª: core/models.py

Car:
    # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    vin                 # VIN –Ω–æ–º–µ—Ä (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π, 17 —Å–∏–º–≤–æ–ª–æ–≤)
    brand               # –ú–∞—Ä–∫–∞ (Toyota, BMW –∏ —Ç.–¥.)
    year                # –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞
    
    # –¢–ò–ü –¢–†–ê–ù–°–ü–û–†–¢–ù–û–ì–û –°–†–ï–î–°–¢–í–ê (11 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
    vehicle_type:
        SEDAN           # –õ–µ–≥–∫–æ–≤–æ–π (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç THS: 1.0)
        CROSSOVER       # –ö—Ä–æ—Å—Å–æ–≤–µ—Ä (1.2)
        SUV             # –î–∂–∏–ø (1.5)
        PICKUP          # –ü–∏–∫–∞–ø (1.5)
        NEW_CAR         # –ù–æ–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å (1.0)
        MOTO            # –ú–æ—Ç–æ—Ü–∏–∫–ª (0.3)
        BIG_MOTO        # –ë–æ–ª—å—à–æ–π –º–æ—Ç–æ—Ü–∏–∫–ª (0.5)
        ATV             # –ö–≤–∞–¥—Ä–æ—Ü–∏–∫–ª/–ë–∞–≥–≥–∏ (0.5)
        BOAT            # –õ–æ–¥–∫–∞ (2.0)
        RV              # –ê–≤—Ç–æ–¥–æ–º (3.0)
        CONSTRUCTION    # –°—Ç—Ä. —Ç–µ—Ö–Ω–∏–∫–∞ (2.5)
    
    # –°–≤—è–∑–∏
    container           # FK ‚Üí Container (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–ª—è –¢–° –±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
    client              # FK ‚Üí Client (–≤–ª–∞–¥–µ–ª–µ—Ü)
    warehouse           # FK ‚Üí Warehouse (—Å–∫–ª–∞–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è)
    line                # FK ‚Üí Line (–º–æ—Ä—Å–∫–∞—è –ª–∏–Ω–∏—è)
    carrier             # FK ‚Üí Carrier (–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫)
    
    # –°—Ç–∞—Ç—É—Å –∏ –¥–∞—Ç—ã
    status              # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    unload_date         # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ)
    transfer_date       # –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª–∏–µ–Ω—Ç—É
    
    # –•—Ä–∞–Ω–µ–Ω–∏–µ
    free_days           # –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (–∏–∑ —Å–∫–ª–∞–¥–∞)
    days                # –ü–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏ (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    storage_cost        # –°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–Ω–∏ √ó —Å—Ç–∞–≤–∫–∞)
    
    # –¶–µ–Ω–∞
    total_price         # –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ = —Å—É–º–º–∞ –≤—Å–µ—Ö —É—Å–ª—É–≥ + –Ω–∞—Ü–µ–Ω–∫–∏
    proft               # –ù–∞—Ü–µ–Ω–∫–∞ Caromoto Lithuania (legacy –ø–æ–ª–µ)
    hide_markup_in      # FK ‚Üí CarService (–≤ –∫–∞–∫—É—é —É—Å–ª—É–≥—É —Å–∫—Ä—ã—Ç—å –Ω–∞—Ü–µ–Ω–∫—É)
    
    # –î–æ–∫—É–º–µ–Ω—Ç—ã
    has_title           # –ï—Å—Ç—å –ª–∏ Title
    title_notes         # –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ Title

    # –î–æ–ø.—Ä–∞—Å—Ö–æ–¥—ã (legacy –ø–æ–ª—è, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å—Ç–∞—Ä—ã—Ö —Ä–∞—Å—á–µ—Ç–∞—Ö/–æ—Ç—á–µ—Ç–∞—Ö)
    unload_fee, delivery_fee, loading_fee, docs_fee, transfer_fee
    transit_declaration, export_declaration, extra_costs, complex_fee
    price, auction_fee, transport_usa, ocean_freight, transport_kz
    broker_fee, additional_expenses, rate
```

### CarService (–°–≤—è–∑—å –¢–° —Å —É—Å–ª—É–≥–∞–º–∏)

```python
# –§–∞–π–ª: core/models.py

CarService:
    car                 # FK ‚Üí Car
    service_type        # LINE, WAREHOUSE, CARRIER –∏–ª–∏ COMPANY
    service_id          # ID —É—Å–ª—É–≥–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ (LineService/WarehouseService/CarrierService/CompanyService)
    custom_price        # –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π)
    markup_amount       # –°–ö–†–´–¢–ê–Ø –ù–ê–¶–ï–ù–ö–ê (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–Ω–µ –≤ –∏–Ω–≤–æ–π—Å–µ, –Ω–µ –≤–∏–¥–Ω–∞ –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–¥–µ–ª—å–Ω–æ)
    quantity            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–æ–±—ã—á–Ω–æ 1)
    notes               # –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
    
    # –°–≤–æ–π—Å—Ç–≤–∞ (property)
    final_price         # = custom_price √ó quantity (–ë–ï–ó –Ω–∞—Ü–µ–Ω–∫–∏, –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—á—ë—Ç–∞)
    invoice_price       # = (custom_price + markup_amount) √ó quantity (–¥–ª—è –∏–Ω–≤–æ–π—Å–∞ –∫–ª–∏–µ–Ω—Ç—É)
```

### –£—Å–ª—É–≥–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤

```python
# –§–∞–π–ª: core/models.py

LineService:            # –£—Å–ª—É–≥–∏ –º–æ—Ä—Å–∫–∏—Ö –ª–∏–Ω–∏–π
    line                # FK ‚Üí Line
    name                # "THS MAERSK 3 –ê–í–¢–û", "–î–æ–∫—É–º–µ–Ω—Ç—ã" –∏ —Ç.–¥.
    short_name          # –°–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ (THS, –ü–æ—Ä—Ç, –•—Ä–∞–Ω, –î–æ–∫)
    default_price       # –¶–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_markup      # –ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    is_active           # –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞
    add_by_default      # ‚úÖ –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¢–° —ç—Ç–æ–π –ª–∏–Ω–∏–∏

WarehouseService:       # –£—Å–ª—É–≥–∏ —Å–∫–ª–∞–¥–æ–≤
    warehouse           # FK ‚Üí Warehouse
    name                # "–•—Ä–∞–Ω–µ–Ω–∏–µ", "–†–∞–∑–≥—Ä—É–∑–∫–∞", "–î–æ–∫—É–º–µ–Ω—Ç—ã" –∏ —Ç.–¥.
    short_name          # –°–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ (–•—Ä–∞–Ω, –ü–æ—Ä—Ç, –î–æ–∫)
    default_price       # –¶–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è "–•—Ä–∞–Ω–µ–Ω–∏–µ" ‚Äî —Å—Ç–∞–≤–∫–∞ –∑–∞ –î–ï–ù–¨)
    default_markup      # –ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è "–•—Ä–∞–Ω–µ–Ω–∏–µ" ‚Äî –Ω–∞—Ü–µ–Ω–∫–∞ –∑–∞ –î–ï–ù–¨)
    is_active           # –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞
    add_by_default      # ‚úÖ –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¢–° –Ω–∞ —ç—Ç–æ–º —Å–∫–ª–∞–¥–µ

CarrierService:         # –£—Å–ª—É–≥–∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–æ–≤
    carrier             # FK ‚Üí Carrier
    name                # "–î–æ—Å—Ç–∞–≤–∫–∞", "–ü–æ–≥—Ä—É–∑–∫–∞" –∏ —Ç.–¥.
    short_name          # –°–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ (–î–æ—Å—Ç, –ü–æ—Ä—Ç)
    default_price       # –¶–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_markup      # –ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    is_active           # –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞
    add_by_default      # ‚úÖ –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¢–° —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞

CompanyService:         # –£—Å–ª—É–≥–∏ –∫–æ–º–ø–∞–Ω–∏–π
    company             # FK ‚Üí Company (Caromoto Lithuania –∏ –¥—Ä.)
    name                # "–î–æ–∫—É–º–µ–Ω—Ç—ã", "–ö–æ–º–∏—Å—Å–∏—è" –∏ —Ç.–¥.
    short_name          # –°–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ (–î–æ–∫, –ö–æ–º–∏—Å)
    description         # –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
    default_price       # –¶–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_markup      # –ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    is_active           # –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞
    add_by_default      # ‚úÖ –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¢–° –∫–æ–º–ø–∞–Ω–∏–∏

AutoTransport:          # –ê–≤—Ç–æ–≤–æ–∑ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É ‚≠ê –ù–û–í–û–ï
    number              # –ù–æ–º–µ—Ä –∞–≤—Ç–æ–≤–æ–∑–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: AT-YYYYMMDD-NNNN)
    carrier             # FK ‚Üí Carrier (–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫)
    eori_code           # EORI –∫–æ–¥ (–∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞)
    truck               # FK ‚Üí CarrierTruck (–∞–≤—Ç–æ–≤–æ–∑)
    driver              # FK ‚Üí CarrierDriver (–≤–æ–¥–∏—Ç–µ–ª—å)
    truck_number_manual # –†—É—á–Ω–æ–π –≤–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç—è–≥–∞—á–∞ (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –±–∞–∑–µ)
    trailer_number_manual # –†—É—á–Ω–æ–π –≤–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏—Ü–µ–ø–∞
    driver_name_manual  # –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∏–º–µ–Ω–∏ –≤–æ–¥–∏—Ç–µ–ª—è
    driver_phone        # –¢–µ–ª–µ—Ñ–æ–Ω –≤–æ–¥–∏—Ç–µ–ª—è (–∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ)
    border_crossing     # –ì—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è (choices)
    cars                # ManyToMany ‚Üí Car (–∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –≤ –∞–≤—Ç–æ–≤–æ–∑–µ)
    loading_date        # –î–∞—Ç–∞ –ø–æ–≥—Ä—É–∑–∫–∏
    departure_date      # –î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    estimated_delivery_date # –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –¥–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
    actual_delivery_date    # –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
    status              # DRAFT, FORMED, LOADED, IN_TRANSIT, DELIVERED, CANCELLED
    notes               # –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
    created_by          # FK ‚Üí User (–∫—Ç–æ —Å–æ–∑–¥–∞–ª)
    created_at, updated_at # –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    
    # –ü—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω" (FORMED):
    # - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–≤–æ–π—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, —á—å–∏ –¢–° –≤ –∞–≤—Ç–æ–≤–æ–∑–µ
    # - –ï—Å–ª–∏ –≤—Å–µ –¢–° –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ - —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω –∏–Ω–≤–æ–π—Å
    # - –ò–Ω–≤–æ–π—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–∞–≤–∞ –∞–≤—Ç–æ–≤–æ–∑–∞

CarrierTruck:           # –ê–≤—Ç–æ–≤–æ–∑—ã –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ ‚≠ê –ù–û–í–û–ï
    carrier             # FK ‚Üí Carrier
    truck_number        # –ù–æ–º–µ—Ä —Ç—è–≥–∞—á–∞
    trailer_number      # –ù–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞
    is_active           # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (default: True)
    created_at, updated_at # –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    
    # Property: full_number - –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä "XXXXX / YYYYY"

CarrierDriver:          # –í–æ–¥–∏—Ç–µ–ª–∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ ‚≠ê –ù–û–í–û–ï
    carrier             # FK ‚Üí Carrier
    first_name          # –ò–º—è
    last_name           # –§–∞–º–∏–ª–∏—è
    phone               # –¢–µ–ª–µ—Ñ–æ–Ω
    is_active           # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (default: True)
    created_at, updated_at # –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    
    # Property: full_name - –ø–æ–ª–Ω–æ–µ –∏–º—è "–ò–º—è –§–∞–º–∏–ª–∏—è"

# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Carrier:
Carrier:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    eori_code           # ‚≠ê –ù–û–í–û–ï: EORI –∫–æ–¥ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞
    # –°–≤—è–∑–∏:
    # - trucks (CarrierTruck)
    # - drivers (CarrierDriver)
    # - auto_transports (AutoTransport)

# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ NewInvoice:
NewInvoice:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    auto_transport      # ‚≠ê –ù–û–í–û–ï: FK ‚Üí AutoTransport (—Å–≤—è–∑—å —Å –∞–≤—Ç–æ–≤–æ–∑–æ–º)
```

### ClientTariffRate (–¢–∞—Ä–∏—Ñ –∫–ª–∏–µ–Ω—Ç–∞) ‚≠ê –ù–û–í–û–ï

```python
# –§–∞–π–ª: core/models.py

ClientTariffRate:
    client              # FK ‚Üí Client
    vehicle_type        # –¢–∏–ø –¢–° (SEDAN, SUV, MOTO –∏ —Ç.–¥.)
    min_cars            # –û—Ç —Å–∫–æ–ª—å–∫–∏ –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
    max_cars            # –î–æ —Å–∫–æ–ª—å–∫–∏ –¢–° (NULL = –∏ –±–æ–ª–µ–µ)
    agreed_total_price  # –û–±—â–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –∞–≤—Ç–æ (‚Ç¨)
                        # –í–∫–ª—é—á–∞–µ—Ç –í–°–ï —É—Å–ª—É–≥–∏ –ö–†–û–ú–ï —Ö—Ä–∞–Ω–µ–Ω–∏—è

# –ü–æ–ª–µ tariff_type –≤ –º–æ–¥–µ–ª–∏ Client:
Client:
    tariff_type:
        NONE            # –ë–µ–∑ —Ç–∞—Ä–∏—Ñ–∞ (–æ–±—ã—á–Ω—ã–µ –Ω–∞—Ü–µ–Ω–∫–∏)
        FIXED           # –§–∏–∫—Å. —Ü–µ–Ω–∞ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª-–≤–∞ –∞–≤—Ç–æ)
        FLEXIBLE        # –ì–∏–±–∫–∞—è —Ü–µ–Ω–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª-–≤–∞ –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `apply_client_tariffs_for_container()`
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ç–∞—Ä–∏—Ñ–æ–º –∏—â–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ `vehicle_type` –∏ `min_cars/max_cars`
3. –°—É–º–º–∏—Ä—É–µ—Ç—Å—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö –Ω–µ-—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ª—É–≥ –∞–≤—Ç–æ
4. –†–∞–∑–Ω–∏—Ü–∞ (agreed_total_price ‚àí —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ—Ä–æ–≤–Ω—É –∫–∞–∫ –Ω–∞—Ü–µ–Ω–∫–∞
5. –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (FLEXIBLE):**

| –¢–∏–ø –¢–° | –û—Ç | –î–æ | –¶–µ–Ω–∞ –∑–∞ –∞–≤—Ç–æ (‚Ç¨) |
|---------|----|----|-------------------|
| –õ–µ–≥–∫–æ–≤–æ–π | 3 | 3 | 290 |
| –õ–µ–≥–∫–æ–≤–æ–π | 4 | 4 | 265 |
| –õ–µ–≥–∫–æ–≤–æ–π | 5 | ‚Äî | 240 |

### SiteProConnection (–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ site.pro) ‚≠ê –ù–û–í–û–ï (09.02.2026)

```python
# –§–∞–π–ª: core/models_accounting.py

SiteProConnection:
    company             # FK ‚Üí Company
    _api_key            # API Key (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω Fernet)
    _private_key        # Private Key (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω Fernet)
    _username           # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ª–æ–≥–∏–Ω (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)
    _password           # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–∞—Ä–æ–ª—å (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)
    is_active           # –ê–∫—Ç–∏–≤–Ω–æ –ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    auto_push_on_issue  # –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ ISSUED
    default_vat_rate    # –°—Ç–∞–≤–∫–∞ –ù–î–° –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (0 –∏–ª–∏ 21)
    default_currency    # –í–∞–ª—é—Ç–∞ (EUR, USD, GBP)
    invoice_series      # –°–µ—Ä–∏—è –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∏–Ω–≤–æ–π—Å–æ–≤
    last_synced_at      # –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
    last_error          # –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞
    
    # Property: base_url ‚Üí 'https://site.pro/My-Accounting/api'
    # Property: api_key ‚Üí —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π _api_key

SiteProInvoiceSync:
    connection          # FK ‚Üí SiteProConnection
    invoice             # FK ‚Üí NewInvoice
    external_id         # ID –ø—Ä–æ–¥–∞–∂–∏ –≤ site.pro
    external_number     # –ù–æ–º–µ—Ä –≤ site.pro
    pdf_url             # –°—Å—ã–ª–∫–∞ –Ω–∞ PDF –∏–Ω–≤–æ–π—Å–∞
    sync_status         # PENDING, SENT, FAILED, PDF_READY
    error_message       # –û—à–∏–±–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏
    synced_at           # –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

### ExpenseCategory (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤/–¥–æ—Ö–æ–¥–æ–≤)

```python
# –§–∞–π–ª: core/models_billing.py

ExpenseCategory:
    name                # –õ–æ–≥–∏—Å—Ç–∏–∫–∞, –ê—Ä–µ–Ω–¥–∞, –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ, –ó–∞—Ä–ø–ª–∞—Ç—ã, –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ù–∞–ª–æ–≥–∏, –ü—Ä–æ—á–∏–µ
    short_name          # –õ–æ–≥, –ê—Ä–µ–Ω–¥–∞, –ö–æ–º–º, –ó–ü, –ú–∞—Ä–∫, –ù–∞–ª–æ–≥, –ü—Ä–æ—á
    category_type       # OPERATIONAL, ADMINISTRATIVE, SALARY, MARKETING, TAX, OTHER
    is_active           # bool
    order               # –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    
    # –°–≤—è–∑–∏:
    # NewInvoice.category ‚Üí FK ‚Üí ExpenseCategory
    # Transaction.category ‚Üí FK ‚Üí ExpenseCategory
```

### BankTransaction (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Äî reconciliation)

```python
# –§–∞–π–ª: core/models_banking.py (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è)

BankTransaction (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è):
    matched_transaction   # FK ‚Üí Transaction (nullable) ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    matched_invoice       # FK ‚Üí NewInvoice (nullable) ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∏–Ω–≤–æ–π—Å—É
    reconciliation_note   # CharField(255) ‚Äî –∑–∞–º–µ—Ç–∫–∞ –æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏
    reconciliation_skipped # BooleanField(default=False) ‚Äî "–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏" (–∫–æ–º–∏—Å—Å–∏–∏, –æ–±–º–µ–Ω—ã –∏ —Ç.–¥.)
    
    # Property: is_reconciled ‚Üí True –µ—Å–ª–∏ matched_transaction –ò–õ–ò matched_invoice –ò–õ–ò reconciliation_skipped
    
    # –ê–≤—Ç–æ-–ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Revolut:
    # –ù–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ fee/exchange/tax –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è reconciliation_skipped=True
```

### NewInvoice (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Äî —É—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ reconciliation)

```python
# –§–∞–π–ª: core/models_billing.py (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è)

NewInvoice (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è):
    category             # FK ‚Üí ExpenseCategory (nullable) ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–∞/–¥–æ—Ö–æ–¥–∞
    attachment           # FileField ‚Äî PDF/—Ñ–æ—Ç–æ —Å—á—ë—Ç–∞
    external_number      # CharField(100) ‚Äî –Ω–æ–º–µ—Ä —Å—á—ë—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ (–¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å –±–∞–Ω–∫–æ–º)
    
    # Property: direction ‚Üí OUTGOING (issuer=Caromoto), INCOMING (recipient=Caromoto), INTERNAL
    # Property: direction_display ‚Üí '–ò—Å—Ö–æ–¥—è—â–∏–π', '–í—Ö–æ–¥—è—â–∏–π', '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π'
```

### LineTHSCoefficient (–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã THS)

```python
# –§–∞–π–ª: core/models.py

LineTHSCoefficient:
    line                # FK ‚Üí Line
    vehicle_type        # –¢–∏–ø –¢–° (SEDAN, MOTO –∏ —Ç.–¥.)
    coefficient         # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–≤–µ—Å) –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è THS
    
    # –ü—Ä–∏–º–µ—Ä: –õ–∏–Ω–∏—è MAERSK
    # SEDAN: 1.0, SUV: 1.5, MOTO: 0.3, BOAT: 2.0
```

---

## üí∞ –°–ò–°–¢–ï–ú–ê THS (TERMINAL HANDLING SURCHARGE)

### –ß—Ç–æ —Ç–∞–∫–æ–µ THS

THS ‚Äî —ç—Ç–æ —Å–±–æ—Ä –º–æ—Ä—Å–∫–∏—Ö –ª–∏–Ω–∏–π –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –ø–æ—Ä—Ç—É. –°—É–º–º–∞ THS —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –¢–° –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Ö "–≤–µ—Å—É" (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—É).

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è THS

```
1. –ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—É–º–º—É THS –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¢–° –ø–æ–ª—É—á–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –µ–≥–æ —Ç–∏–ø–∞ –∏–∑ LineTHSCoefficient
3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ª—é: THS_–¢–° = –æ–±—â–∏–π_THS √ó (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç / —Å—É–º–º–∞_–≤—Å–µ—Ö_–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤)
4. –û–∫—Ä—É–≥–ª–∏—Ç—å –í–í–ï–†–• –¥–æ 5 EUR (73.12 ‚Üí 75 EUR)
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞

```
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä THS = 500 EUR
3 –¢–°: –ª–µ–≥–∫–æ–≤–æ–π(1.0) + –¥–∂–∏–ø(1.5) + –º–æ—Ç–æ(0.3) = —Å—É–º–º–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ 2.8

- –õ–µ–≥–∫–æ–≤–æ–π: 500 √ó (1.0/2.8) = 178.57 ‚Üí –æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ 180 EUR
- –î–∂–∏–ø: 500 √ó (1.5/2.8) = 267.86 ‚Üí –æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ 270 EUR  
- –ú–æ—Ç–æ: 500 √ó (0.3/2.8) = 53.57 ‚Üí –æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ 55 EUR
```

### –ü–æ–ª–µ ths_payer

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –æ—Ç —á—å–µ–≥–æ –∏–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∞—Ç—å —Ä–∞—Å—Ö–æ–¥ THS –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –¢–°:

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –£—Å–ª—É–≥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–∞–∫ |
|----------|----------|---------------------|
| `LINE` | –û–ø–ª–∞—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é –ª–∏–Ω–∏–∏ | CarService —Å service_type='LINE' |
| `WAREHOUSE` | –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ —Å–∫–ª–∞–¥ | CarService —Å service_type='WAREHOUSE' |

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WAREHOUSE:** –ò–Ω–æ–≥–¥–∞ —Å–∫–ª–∞–¥ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç THS –ª–∏–Ω–∏–∏ –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏, –∞ –ø–æ—Ç–æ–º –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç —Å—á—ë—Ç –Ω–∞–º. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ THS –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —É—Å–ª—É–≥–∞ —Å–∫–ª–∞–¥–∞.

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
# –§–∞–π–ª: core/signals.py

calculate_ths_for_container(container)
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç THS –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¢–° –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {car_id: ths_amount}

create_ths_services_for_container(container)
    # –°–æ–∑–¥–∞—ë—Ç CarService –∑–∞–ø–∏—Å–∏ —Å THS –¥–ª—è –≤—Å–µ—Ö –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    # –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ THS-—É—Å–ª—É–≥–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
    # –¢–∏–ø —É—Å–ª—É–≥–∏ (LINE/WAREHOUSE) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ–ª–µ–º ths_payer

round_up_to_5(value)
    # –û–∫—Ä—É–≥–ª—è–µ—Ç –≤–≤–µ—Ä—Ö —Å —à–∞–≥–æ–º 5 EUR
    # –ü—Ä–∏–º–µ—Ä: 73.12 ‚Üí 75
```

### –ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è THS

1. **–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** ‚Äî –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ø–æ–ª—è: `line`, `ths`, `ths_payer`, `warehouse`
2. **–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å THS"** –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ª–∏–Ω–∏–∏

---

## üè≠ –°–ò–°–¢–ï–ú–ê –£–°–õ–£–ì –°–ö–õ–ê–î–û–í

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¢–° –Ω–∞ —Å–∫–ª–∞–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —É—Å–ª—É–≥–∏ —Å —Ñ–ª–∞–≥–æ–º `add_by_default=True`.

**–î–ª—è –ª–∏–Ω–∏–π, –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–æ–≤ –∏ –∫–æ–º–ø–∞–Ω–∏–π:**
- –õ–æ–≥–∏–∫–∞ `add_by_default` —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–∫–ª–∞–¥–∞–º
- –£—Å–ª—É–≥–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –¢–°**, —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¢–° –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è

**–¢–∏–ø–∏—á–Ω—ã–µ —É—Å–ª—É–≥–∏ —Å–∫–ª–∞–¥–∞:**
- **–•—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî —Ü–µ–Ω–∞ = –ø–ª–∞—Ç–Ω—ã–µ_–¥–Ω–∏ √ó —Å—Ç–∞–≤–∫–∞_–∑–∞_–¥–µ–Ω—å
- **–†–∞–∑–≥—Ä—É–∑–∫–∞** ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞
- **–î–æ–∫—É–º–µ–Ω—Ç—ã** ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞
- **–ü–æ–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ç—Ä–∞–ª** ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞

### –£—Å–ª—É–≥–∞ "–•—Ä–∞–Ω–µ–Ω–∏–µ" ‚Äî –æ—Å–æ–±–∞—è –ª–æ–≥–∏–∫–∞

```python
# –¶–µ–Ω–∞ —É—Å–ª—É–≥–∏ "–•—Ä–∞–Ω–µ–Ω–∏–µ" —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏:

storage_price = –ø–ª–∞—Ç–Ω—ã–µ_–¥–Ω–∏ √ó —Ü–µ–Ω–∞_–∑–∞_–¥–µ–Ω—å
storage_markup = –ø–ª–∞—Ç–Ω—ã–µ_–¥–Ω–∏ √ó –Ω–∞—Ü–µ–Ω–∫–∞_–∑–∞_–¥–µ–Ω—å

# –ì–¥–µ:
# - –ø–ª–∞—Ç–Ω—ã–µ_–¥–Ω–∏ = (—Å–µ–≥–æ–¥–Ω—è –∏–ª–∏ –¥–∞—Ç–∞_–ø–µ—Ä–µ–¥–∞—á–∏) - –¥–∞—Ç–∞_—Ä–∞–∑–≥—Ä—É–∑–∫–∏ - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ_–¥–Ω–∏
# - —Ü–µ–Ω–∞_–∑–∞_–¥–µ–Ω—å –±–µ—Ä—ë—Ç—Å—è –∏–∑ WarehouseService.default_price –¥–ª—è —É—Å–ª—É–≥–∏ "–•—Ä–∞–Ω–µ–Ω–∏–µ"
# - –Ω–∞—Ü–µ–Ω–∫–∞_–∑–∞_–¥–µ–Ω—å –±–µ—Ä—ë—Ç—Å—è –∏–∑ WarehouseService.default_markup
```

**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ –ø–ª–∞—Ç–Ω—ã—Ö –¥–Ω–µ–π –Ω–µ—Ç (–¢–° –µ—â—ë –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏–∏) ‚Äî —Ü–µ–Ω–∞ —É—Å–ª—É–≥–∏ "–•—Ä–∞–Ω–µ–Ω–∏–µ" = 0.

### –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏

- –£–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Å–∫–ª–∞–¥–∞ (`Warehouse.free_days`)
- –ù–∞—Å–ª–µ–¥—É—é—Ç—Å—è –≤ –¢–° –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Å–∫–ª–∞–¥–∞
- –í–ª–∏—è—é—Ç –Ω–∞ —Ä–∞—Å—á—ë—Ç –ø–ª–∞—Ç–Ω—ã—Ö –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è

---

## üíµ –°–ò–°–¢–ï–ú–ê –ù–ê–¶–ï–ù–ö–ò (MARKUP)

### –°–∫—Ä—ã—Ç–∞—è –Ω–∞—Ü–µ–Ω–∫–∞

–ù–∞—Ü–µ–Ω–∫–∞ Caromoto Lithuania ‚Äî —ç—Ç–æ –ø—Ä–∏–±—ã–ª—å –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –≤ –∏–Ω–≤–æ–π—Å–µ. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —É—Å–ª—É–≥–∞–º.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```python
CarService.markup_amount  # –°–∫—Ä—ã—Ç–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —É—Å–ª—É–≥–∏

# –¶–µ–Ω—ã:
final_price = custom_price √ó quantity              # –î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—á—ë—Ç–∞
invoice_price = (custom_price + markup_amount) √ó quantity  # –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞
```

### –ü—Ä–∏–º–µ—Ä

```
–£—Å–ª—É–≥–∞ "–†–∞–∑–≥—Ä—É–∑–∫–∞":
- custom_price = 50 EUR
- markup_amount = 10 EUR
- –í –∏–Ω–≤–æ–π—Å–µ –∫–ª–∏–µ–Ω—Ç—É: 60 EUR (–∫–ª–∏–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç, —á—Ç–æ 10 EUR ‚Äî —ç—Ç–æ –Ω–∞—Ü–µ–Ω–∫–∞)
```

### –ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ CarService –Ω–∞—Ü–µ–Ω–∫–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–∑ `default_markup` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —É—Å–ª—É–≥–∏ (LineService, WarehouseService, CarrierService).

---

## üìß EMAIL-–£–í–ï–î–û–ú–õ–ï–ù–ò–Ø

### –¢—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç–ø—Ä–∞–≤–∫–∏

| –°–æ–±—ã—Ç–∏–µ | –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | –ö–æ–º—É |
|---------|-----------------|------|
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `planned_unload_date` | "–ü–ª–∞–Ω–∏—Ä—É–µ–º —Ä–∞–∑–≥—Ä—É–∑–∫—É" | –í—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º —Å –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |
| –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `unload_date` | "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–∑–≥—Ä—É–∂–µ–Ω" | –í—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º —Å –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞

```python
Client:
    email               # –û—Å–Ω–æ–≤–Ω–æ–π email
    email2, email3, email4  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ email
    notification_enabled    # –ü–æ–ª—É—á–∞—Ç—å –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)
```

### Email-—Å–µ—Ä–≤–∏—Å

```python
# –§–∞–π–ª: core/services/email_service.py

ContainerNotificationService:
    send_planned_to_all_clients(container)  # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π —Ä–∞–∑–≥—Ä—É–∑–∫–µ
    send_unload_to_all_clients(container)   # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–∞–∑–≥—Ä—É–∑–∫–µ
    was_planned_notification_sent(container)  # –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
    was_unload_notification_sent(container)   # –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

–í—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –º–æ–¥–µ–ª–∏ `NotificationLog`. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.

---

## üìÑ –°–ò–°–¢–ï–ú–ê –ò–ù–í–û–ô–°–û–í

### –†—É—á–Ω–æ–π –≤–≤–æ–¥ —Å—É–º–º—ã –∏ –ø–æ–∑–∏—Ü–∏–π (–¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ –±–µ–∑ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π)

–î–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –∏–Ω–≤–æ–π—Å–æ–≤ (–∞—Ä–µ–Ω–¥–∞, –∫–æ–º–º—É–Ω–∞–ª–∫–∞, –ø—Ä–æ—á–∏–µ —Ä–∞—Å—Ö–æ–¥—ã) —Å—É–º–º–∞ –∑–∞–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é:

1. **–ü–æ–ª–µ "–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ"** ‚Äî –≤–≤–µ—Ä—Ö—É —Ñ–æ—Ä–º—ã, —Ä—è–¥–æ–º —Å "–ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞"
   - –ü—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ: readonly, —Å—É–º–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX (`/admin/core/newinvoice/calc-cars-total/`)
   - –ë–µ–∑ –∞–≤—Ç–æ: —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ ‚Äî `total` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ–ª–≥–æ–º –∫–æ–º–ø–∞–Ω–∏–∏

2. **–ë–ª–æ–∫ "–ü–æ–∑–∏—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é"** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ (–æ–ø–∏—Å–∞–Ω–∏–µ + –∫–æ–ª-–≤–æ + —Ü–µ–Ω–∞)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ—Ç –∞–≤—Ç–æ
   - –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π ‚Äî —Å—É–º–º–∞ –≤–≤–µ—Ä—Ö—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
   - –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `manual_items_json` (JSON ‚Üí `InvoiceItem`)

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ** (`NewInvoiceAdmin._handle_manual_items()`):
   - –†—É—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ ‚Üí `InvoiceItem` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
   - –¢–æ–ª—å–∫–æ `manual_total` –±–µ–∑ –ø–æ–∑–∏—Ü–∏–π ‚Üí –æ–¥–Ω–∞ –æ–±—â–∞—è `InvoiceItem`
   - `calculate_totals()` ‚Üí `save()` ‚Üí `remaining_amount` = –¥–æ–ª–≥

### –ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Å–ø–∏—Å–∫–µ –∏–Ω–≤–æ–π—Å–æ–≤
- **–ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ** ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å ISSUED –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤
- **–ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ** ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å PAID
- **–û—Ç–º–µ–Ω–∏—Ç—å –∏–Ω–≤–æ–π—Å—ã** ‚Äî –æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ BillingService
- **–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π** ‚Äî —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è InvoiceItem –ø–æ CarService

### –ú–æ–¥–µ–ª—å NewInvoice

```python
# –§–∞–π–ª: core/models_billing.py

NewInvoice:
    number              # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: INV-202601-0001)
    date                # –î–∞—Ç–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
    due_date            # –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é +14 –¥–Ω–µ–π)
    
    # –í—ã—Å—Ç–∞–≤–∏—Ç–µ–ª—å (–û–î–ò–ù –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö)
    issuer_company      # FK ‚Üí Company (Caromoto Lithuania)
    issuer_warehouse    # FK ‚Üí Warehouse
    issuer_line         # FK ‚Üí Line
    issuer_carrier      # FK ‚Üí Carrier
    
    # –ü–æ–ª—É—á–∞—Ç–µ–ª—å (–û–î–ò–ù –∏–∑ –ø—è—Ç–∏)
    recipient_client    # FK ‚Üí Client
    recipient_warehouse # FK ‚Üí Warehouse
    recipient_line      # FK ‚Üí Line
    recipient_carrier   # FK ‚Üí Carrier
    recipient_company   # FK ‚Üí Company
    
    # –§–∏–Ω–∞–Ω—Å—ã
    subtotal            # –°—É–º–º–∞ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
    discount            # –°–∫–∏–¥–∫–∞
    tax                 # –ù–∞–ª–æ–≥
    total               # –ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ
    paid_amount         # –£–∂–µ –æ–ø–ª–∞—á–µ–Ω–æ
    
    # –°–≤—è–∑—å —Å –¢–°
    cars                # ManyToMany ‚Üí Car (–≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¢–°)
    
    status              # DRAFT, ISSUED, PARTIALLY_PAID, PAID, OVERDUE, CANCELLED
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –¢–° –≤ –∏–Ω–≤–æ–π—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∏—Ö —É—Å–ª—É–≥ (CarService).

**–õ–æ–≥–∏–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –≤—ã—Å—Ç–∞–≤–∏—Ç–µ–ª—è:**

| –í—ã—Å—Ç–∞–≤–∏—Ç–µ–ª—å | –ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è |
|-------------|------------------------|
| Company (Caromoto Lithuania) | –í–°–ï —É—Å–ª—É–≥–∏ + —Ö—Ä–∞–Ω–µ–Ω–∏–µ + —Å–∫—Ä—ã—Ç–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–Ω–∞–º) |
| Warehouse | –¢–æ–ª—å–∫–æ —É—Å–ª—É–≥–∏ —ç—Ç–æ–≥–æ —Å–∫–ª–∞–¥–∞ + —Ö—Ä–∞–Ω–µ–Ω–∏–µ |
| Line | –¢–æ–ª—å–∫–æ —É—Å–ª—É–≥–∏ —ç—Ç–æ–π –ª–∏–Ω–∏–∏ |
| Carrier | –¢–æ–ª—å–∫–æ —É—Å–ª—É–≥–∏ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ |

### –ú–µ—Ç–æ–¥ regenerate_items_from_cars()

```python
# –§–∞–π–ª: core/models_billing.py ‚Üí NewInvoice

regenerate_items_from_cars():
    # 1. –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–Ω–≤–æ–π—Å–∞
    # 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¢–°:
    #    - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ (update_days_and_storage)
    #    - –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç —É—Å–ª—É–≥–∏ –ø–æ short_name (—Å–æ–∫—Ä–∞—â–µ–Ω–∏—é)
    #    - –°—É–º–º–∏—Ä—É–µ—Ç —É—Å–ª—É–≥–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º short_name
    #    - –°–æ–∑–¥–∞—ë—Ç –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –≥—Ä—É–ø–ø—É (description = short_name)
    # 3. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–æ–π "–•—Ä–∞–Ω"
    # 4. –î–ª—è Company: –¥–æ–±–∞–≤–ª—è–µ—Ç markup_amount –∫ —Ü–µ–Ω–∞–º (—Å–∫—Ä—ã—Ç–æ)
    # 5. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–∏

get_items_pivot_table():
    # –§–æ—Ä–º–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
    # - columns: —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö short_name (–∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤)
    # - rows: [{car_label, cells: [amount_per_column], total}]
    # - col_totals: –∏—Ç–æ–≥–æ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–æ–ª–±—Ü—É
    # - grand_total: –æ–±—â–∏–π –∏—Ç–æ–≥
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç –∏–Ω–≤–æ–π—Å–æ–≤

–ò–Ω–≤–æ–π—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Å–ª—É–≥ –¢–° (CarService)
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¢–° (–¥–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å)

–≠—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª—ã –≤ `core/signals.py`.

---

## üì∏ –§–û–¢–û–ì–†–ê–§–ò–ò –ö–û–ù–¢–ï–ô–ù–ï–†–û–í

### Google Drive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```python
# –§–∞–π–ª: core/google_drive_sync.py

GoogleDriveSync:
    sync_container_by_number(container_number)  # –ê–≤—Ç–æ–ø–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –ø–æ –Ω–æ–º–µ—Ä—É
    download_folder_photos(folder_url, container)  # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ
```

### –¢–∏–ø—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

| –¢–∏–ø | –ö–æ–¥ | –ü–∞–ø–∫–∞ –Ω–∞ Google Drive |
|-----|-----|----------------------|
| –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ | `IN_CONTAINER` | "KONTO VIDUS" |
| –í—ã–≥—Ä—É–∂–µ–Ω–Ω—ã–µ | `UNLOADING` | "AUTO I≈† KONTO" |

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∫–µ —Å—Ç–∞—Ç—É—Å–∞ "–†–∞–∑–≥—Ä—É–∂–µ–Ω"
- –£—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–∞—Ç—ã —Ä–∞–∑–≥—Ä—É–∑–∫–∏

### Management –∫–æ–º–∞–Ω–¥–∞

```bash
python manage.py sync_photos_gdrive --no-photos     # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ —Ñ–æ—Ç–æ
python manage.py sync_photos_gdrive --recent        # –ù–µ–¥–∞–≤–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
python manage.py sync_photos_gdrive --container ECMU5566195  # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π
```

---

## ü§ñ AI-–ü–û–ú–û–©–ù–ò–ö

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –ß–∞—Ç-–≤–∏–¥–∂–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º —Å–∞–π—Ç–µ –∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ –ë–î: VIN/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Å—Ç–∞—Ç—É—Å, —Å–∫–ª–∞–¥, –¥–∞—Ç—ã –∏ —Ñ–æ—Ç–æ
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã (—Ü–µ–Ω—ã/–æ–ø–ª–∞—Ç—ã/–±–∞–ª–∞–Ω—Å—ã/–∏–Ω–≤–æ–π—Å—ã) –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É
- –°—Å—ã–ª–∫–∏ –Ω–∞ –≥–∞–ª–µ—Ä–µ—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–π —Å—Å—ã–ª–∫–æ–π –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –í –∞–¥–º–∏–Ω–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `page_context` + –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Admin-Chat`
- RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–ª—é—á–µ–≤—ã–º —Ñ–∞–π–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞
- –í AIChat —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `context_snapshot` (page context)

### –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–∞–ª–µ—Ä–µ—é
- `/?track=<–Ω–æ–º–µ—Ä_–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞>&photos=1` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–∏—Å–∫ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–æ—Ç–æ

### Endpoint
- `POST /api/ai-chat/` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `message`, `session_id`, `page_context`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`
```
AI_CHAT_ENABLED=True
AI_API_KEY=...
AI_API_BASE_URL=https://api.openai.com/v1
AI_MODEL=gpt-4o-mini
AI_MAX_TOKENS=400
AI_TEMPERATURE=0.2
AI_REQUEST_TIMEOUT=40
AI_EMBEDDINGS_MODEL=text-embedding-3-small
AI_RAG_INDEX_PATH=./data/ai_rag_index.json
AI_RAG_TOP_K=6
AI_RAG_MAX_AGE_HOURS=72
HTTP_PROXY=
HTTPS_PROXY=
NO_PROXY=localhost,127.0.0.1
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
- `core/services/ai_chat_service.py` ‚Äî —Å–µ—Ä–≤–∏—Å AI, —Å–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≤—ã–∑–æ–≤ API
- `core/services/admin_ai_agent.py` ‚Äî –∞–¥–º–∏–Ω-–∞–≥–µ–Ω—Ç, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, UI-–ø–æ–¥—Å–∫–∞–∑–∫–∏
- `core/services/ai_rag.py` ‚Äî RAG –∏–Ω–¥–µ–∫—Å, –ø–æ–∏—Å–∫, —Å–Ω–∏–ø–ø–µ—Ç—ã
- `core/views_website.py` ‚Äî endpoint –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (—Ñ–∏–Ω–∞–Ω—Å—ã/—Ñ–æ—Ç–æ/—Å—Å—ã–ª–∫–∏)
- `core/static/website/js/ai-chat.js` ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —á–∞—Ç, CSRF, –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- `templates/admin/base_site.html` + `core/static/admin/css/ai-chat.css` ‚Äî –≤–∏–¥–∂–µ—Ç –≤ –∞–¥–º–∏–Ω–∫–µ
- `core/management/commands/rebuild_ai_index.py`
- `core/management/commands/rebuild_ai_index_if_stale.py`

## üîß –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

```
logist2/
‚îú‚îÄ‚îÄ core/                           # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models.py                   # –ì–ª–∞–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ (Container, Car, CarService –∏ –¥—Ä.)
‚îÇ   ‚îú‚îÄ‚îÄ models_billing.py           # –ò–Ω–≤–æ–π—Å—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, ExpenseCategory
‚îÇ   ‚îú‚îÄ‚îÄ models_banking.py           # BankConnection, BankAccount, BankTransaction (+ reconciliation)
‚îÇ   ‚îú‚îÄ‚îÄ models_accounting.py        # Site.pro –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (SiteProConnection, SiteProInvoiceSync)
‚îÇ   ‚îú‚îÄ‚îÄ models_website.py           # –ú–æ–¥–µ–ª–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ admin/                      # Django Admin (–ø–∞–∫–µ—Ç, —Å 08.02.2026)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py             # –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inlines.py              # –í—Å–µ inline-–∫–ª–∞—Å—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ container.py            # ContainerAdmin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ car.py                  # CarAdmin (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ partners.py             # Warehouse, Client, Company, Line, Carrier, AutoTransport
‚îÇ   ‚îú‚îÄ‚îÄ admin_billing.py            # Admin –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, ExpenseCategory
‚îÇ   ‚îú‚îÄ‚îÄ admin_banking.py            # Admin –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (+ reconciliation —Ñ–∏–ª—å—Ç—Ä—ã)
‚îÇ   ‚îú‚îÄ‚îÄ admin_accounting.py         # Admin –¥–ª—è site.pro (SiteProConnectionAdmin, SiteProInvoiceSyncAdmin)
‚îÇ   ‚îú‚îÄ‚îÄ admin_website.py            # Admin –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils.py                    # –£—Ç–∏–ª–∏—Ç—ã (round_up_to_5, WebSocketBatcher)
‚îÇ   ‚îú‚îÄ‚îÄ throttles.py                # Rate limiting (TrackShipmentThrottle 20/–º–∏–Ω, AIChatThrottle 10/–º–∏–Ω)
‚îÇ   ‚îú‚îÄ‚îÄ tasks.py                    # Celery –∑–∞–¥–∞—á–∏ (—Ñ–æ–Ω–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email —Å retry-–ª–æ–≥–∏–∫–æ–π)
‚îÇ   ‚îú‚îÄ‚îÄ tests/                      # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django TestCase —Ç–µ—Å—Ç—ã (18 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_models.py          # –ú–æ–¥–µ–ª–∏: Company.get_default(), Container/Car –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_signals.py         # –°–∏–≥–Ω–∞–ª—ã: thread-safe instance attrs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_billing.py         # –ë–∏–ª–ª–∏–Ω–≥: NewInvoice –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ signals.py                  # –°–∏–≥–Ω–∞–ª—ã (thread-safe instance attrs, THS, email —á–µ—Ä–µ–∑ Celery)
‚îÇ   ‚îú‚îÄ‚îÄ views.py                    # Views –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ views_website.py            # Views –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞ (—Å rate limiting)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ google_drive_sync.py        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Drive
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard_service.py    # DashboardService ‚Äî KPI, –≥—Ä–∞—Ñ–∏–∫–∏, P&L –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sitepro_service.py      # SiteProService ‚Äî API-–∫–ª–∏–µ–Ω—Ç site.pro Accounting
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email_service.py        # Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_chat_service.py      # AI-–ø–æ–º–æ—â–Ω–∏–∫ (–∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –ë–î)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin_ai_agent.py       # AI-–∞–≥–µ–Ω—Ç –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (–∫–æ–Ω—Ç–µ–∫—Å—Ç + –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_rag.py               # RAG –∏–Ω–¥–µ–∫—Å –∏ –ø–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏/–∫–æ–¥—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ billing_service.py      # –ë–∏–ª–ª–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ balance_manager.py      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ management/commands/        # Management –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rebuild_ai_index.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rebuild_ai_index_if_stale.py
‚îÇ   ‚îî‚îÄ‚îÄ migrations/                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (88+ —Ñ–∞–π–ª–æ–≤)
‚îÇ
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ admin/                      # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_site.html          # Sidebar + Topbar layout + JS —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è changelist
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ change_list.html        # Unified toolbar (search + actions + add)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ line_change.html        # –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å THS"
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ multi_status_filter.html        # –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ multi_warehouse_filter.html     # –§–∏–ª—å—Ç—Ä –ø–æ —Å–∫–ª–∞–¥–∞–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ core/                   # –®–∞–±–ª–æ–Ω—ã –º–æ–¥–µ–ª–µ–π (container, car change_form)
‚îÇ   ‚îú‚îÄ‚îÄ email/                      # –®–∞–±–ª–æ–Ω—ã email
‚îÇ   ‚îî‚îÄ‚îÄ website/                    # –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–∞–π—Ç
‚îÇ
‚îú‚îÄ‚îÄ static/website/images/
‚îÇ   ‚îî‚îÄ‚îÄ logo_caromoto.svg           # SVG-–ª–æ–≥–æ—Ç–∏–ø –¥–ª—è topbar –∞–¥–º–∏–Ω–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ run_all_tests.py                # Legacy —Ç–µ—Å—Ç—ã (67, atomic rollback –Ω–∞ —Ä–∞–±–æ—á–µ–π –ë–î)
‚îú‚îÄ‚îÄ logist2/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py                 # –õ–æ–∫–∞–ª—å–Ω—ã–µ (InMemory Channels, Redis cache, ENCRYPTION_KEY, SQLite –¥–ª—è —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ settings_base.py            # –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Redis Channels, RedisCache db=1, Celery broker db=2, MEDIA_URL/MEDIA_ROOT)
‚îÇ   ‚îú‚îÄ‚îÄ settings_dev.py             # Dev-–ø—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ settings_prod.py            # Prod-–ø—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ admin_site.py               # LogistAdminSite ‚Äî 6 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø –≤ —Å–∞–π–¥–±–∞—Ä–µ
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                 # Monkey-patch admin.site –¥–ª—è LogistAdminSite
‚îÇ   ‚îú‚îÄ‚îÄ celery.py                   # Celery app –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                 # –ò–º–ø–æ—Ä—Ç celery app —Å fallback
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                     # URL routing (API v1 + legacy aliases)
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py / asgi.py           # WSGI/ASGI
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt                # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ requirements_website.txt        # –î–æ–ø. –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–∞–π—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ SYNC_GUIDE.md                   # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–∞—à–∏–Ω–∞–º–∏
‚îú‚îÄ‚îÄ sync_from_vps.ps1               # PowerShell-—Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å VPS
‚îî‚îÄ‚îÄ vps_push.sh                     # Bash-—Å–∫—Ä–∏–ø—Ç –∫–æ–º–º–∏—Ç–∞/–ø—É—à–∞ —Å VPS
```

---

## üîÑ –ö–õ–Æ–ß–ï–í–´–ï –°–ò–ì–ù–ê–õ–´

### –§–∞–π–ª: core/signals.py

```python
# –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ Container (thread-safe: —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ instance._pre_save_*)
save_old_container_values()          # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ù–ê –≠–ö–ó–ï–ú–ü–õ–Ø–†–ï (–Ω–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º dict!)
update_related_on_container_save()   # –û–±–Ω–æ–≤–ª—è–µ—Ç –¢–° –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
save_old_notification_values()       # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç planned_unload_date/unload_date –ù–ê –≠–ö–ó–ï–ú–ü–õ–Ø–†–ï
send_container_notifications_on_save()  # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
auto_sync_photos_on_container_change()  # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ —Å Google Drive

# –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ Car (thread-safe: —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –Ω–∞ instance._pre_save_contractors)
save_old_contractors()               # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –ù–ê –≠–ö–ó–ï–ú–ü–õ–Ø–†–ï
update_related_on_car_save()         # –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–≤–æ–π—Å—ã
create_car_services_on_car_save()    # –°–æ–∑–¥–∞—ë—Ç —É—Å–ª—É–≥–∏ (—Å–∫–ª–∞–¥, –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫)

# –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ NewInvoice (thread-safe: instance._pre_save_status)
save_old_invoice_status()            # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å –ù–ê –≠–ö–ó–ï–ú–ü–õ–Ø–†–ï
auto_push_invoice_to_sitepro()       # –ê–≤—Ç–æ-push –≤ site.pro –ø—Ä–∏ ISSUED
auto_categorize_invoice()            # –ê–≤—Ç–æ-–∫–∞—Ç–µ–≥–æ—Ä–∏—è "–õ–æ–≥–∏—Å—Ç–∏–∫–∞" –¥–ª—è —Å–∫–ª–∞–¥/–ª–∏–Ω–∏—è/–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫

# –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ CarService
apply_client_tariffs_for_container()  # –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–∞—Ä–∏—Ñ—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –Ω–∞—Ü–µ–Ω–∫–∞–º —É—Å–ª—É–≥

recalculate_invoices_on_car_service_save()   # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–≤–æ–π—Å—ã
recalculate_invoices_on_car_service_delete() # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–≤–æ–π—Å—ã

# –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Å–ª—É–≥ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö
update_cars_on_warehouse_service_change()  # –û–±–Ω–æ–≤–ª—è–µ—Ç CarService
update_cars_on_carrier_service_change()    # –û–±–Ω–æ–≤–ª—è–µ—Ç CarService
update_cars_on_company_service_change()    # –û–±–Ω–æ–≤–ª—è–µ—Ç CarService (Company)
delete_car_services_on_company_service_delete() # –£–¥–∞–ª—è–µ—Ç Company CarService
```

> **–í–ê–ñ–ù–û:** –í—Å–µ pre_save —Å–∏–≥–Ω–∞–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ù–ê –≠–ö–ó–ï–ú–ü–õ–Ø–†–ï –º–æ–¥–µ–ª–∏
> (–Ω–∞–ø—Ä. `instance._pre_save_values`), –∞ –ù–ï –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤–∞—Ä—è—Ö. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç
> thread-safety –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.

---

## ‚öôÔ∏è –ê–î–ú–ò–ù–ö–ê (DJANGO ADMIN)

### ContainerAdmin

**–ò–Ω–ª–∞–π–Ω—ã:**
- `CarInline` ‚Äî —Å–ø–∏—Å–æ–∫ –¢–° –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- ~~`ContainerPhotoInline`~~ ‚Äî **—É–¥–∞–ª—ë–Ω** (10.02.2026). –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—É—é AJAX-–≥–∞–ª–µ—Ä–µ—é (`photos_gallery.html`), –∑–∞–≥—Ä—É–∂–∞–µ–º—É—é –ø–æ –∫–ª–∏–∫—É –∏–∑ `/core/container/<id>/photos-json/`

**Actions:**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ (–í –ø—É—Ç–∏, –í –ø–æ—Ä—Ç—É, –†–∞–∑–≥—Ä—É–∂–µ–Ω, –ü–µ—Ä–µ–¥–∞–Ω)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ—Ç–æ —Å Google Drive
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**save_model() ‚Äî –∫–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
1. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è `warehouse` ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∫–ª–∞–¥ –≤–æ –≤—Å–µ –¢–°
2. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è `status` ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –¢–° (bulk_update)
3. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å `unload_date` ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –≤–æ –≤—Å–µ—Ö –¢–° (bulk_update)
4. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å `line/ths/ths_payer/warehouse` ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å THS

### CarAdmin

**–°–ø–∏—Å–æ–∫ –¢–° (list_display):**
- –°—Ç–æ–ª–±—Ü—ã: VIN, –º–∞—Ä–∫–∞, —Ç–∏–ø –¢–°, –≥–æ–¥, –∫–ª–∏–µ–Ω—Ç, —Å—Ç–∞—Ç—É—Å, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Å–∫–ª–∞–¥, –ª–∏–Ω–∏—è, –¥–∞—Ç–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏, –ø–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏, —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è, —Ü–µ–Ω–∞, **–Ω–∞—Ü–µ–Ω–∫–∞ (–ù)**, Title
- **–°—Ç–æ–ª–±–µ—Ü "–ù" (31.01.2026):** –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ–±—â—É—é —Å–∫—Ä—ã—Ç—É—é –Ω–∞—Ü–µ–Ω–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¢–°
- **–û–±—â–∞—è —Å—É–º–º–∞ –Ω–∞—Ü–µ–Ω–æ–∫:** –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–¥ —Ç–∞–±–ª–∏—Ü–µ–π –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¢–°
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `annotate()` + `Sum()` –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (–æ–¥–∏–Ω SQL –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N+1)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ª—É–≥ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Ü–µ–Ω–∫–∏
- –°–≤–æ–¥–∫–∞ –ø–æ —É—Å–ª—É–≥–∞–º (services_summary_display)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –Ω–∞—Ü–µ–Ω–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### LineAdmin

**–ò–Ω–ª–∞–π–Ω—ã:**
- `LineServiceInline` ‚Äî —É—Å–ª—É–≥–∏ –ª–∏–Ω–∏–∏
- `LineTHSCoefficientInline` ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã THS

**–ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å THS":**
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç THS –¥–ª—è –≤—Å–µ—Ö –¢–° –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö —ç—Ç–æ–π –ª–∏–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

### –†–µ–¥–∏–∑–∞–π–Ω –∞–¥–º–∏–Ω–∫–∏ ‚Äî UI/UX (14.02.2026)

#### Phase 1: Sidebar + Topbar

**–ù–æ–≤—ã–π layout:** Sidebar + Topbar (–≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Django header)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `templates/admin/base_site.html` ‚Äî sidebar, topbar, JS-—Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è changelist
- `templates/admin/change_list.html` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–π —à–∞–±–ª–æ–Ω (unified toolbar)
- `core/static/css/dashboard_admin.css` ‚Äî CSS design system (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —à—Ä–∏—Ñ—Ç—ã, –∫–∞—Ä—Ç–æ—á–∫–∏)
- `static/website/images/logo_caromoto.svg` ‚Äî –ª–æ–≥–æ—Ç–∏–ø –¥–ª—è topbar

**Sidebar (`cm-sidebar`):**
- –ê–≤–∞—Ç–∞—Ä + –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + —Ä–æ–ª—å ‚Äî –≤–≤–µ—Ä—Ö—É (–≤–º–µ—Å—Ç–æ –ª–æ–≥–æ—Ç–∏–ø–∞)
- –ö–Ω–æ–ø–∫–∏ ¬´–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å¬ª / ¬´–í—ã–π—Ç–∏¬ª ‚Äî —Ä—è–¥–æ–º —Å –∏–º–µ–Ω–µ–º
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≥—Ä—É–ø–ø–∞–º: –õ–æ–≥–∏—Å—Ç–∏–∫–∞, –ü–∞—Ä—Ç–Ω—ë—Ä—ã, –§–∏–Ω–∞–Ω—Å—ã, –ë–∞–Ω–∫–∏–Ω–≥ –∏ —Ç.–¥.

**Topbar (`cm-topbar`):**
- –õ–æ–≥–æ—Ç–∏–ø Caromoto (SVG) —Å–ª–µ–≤–∞
- –ò–∫–æ–Ω–∫–∏ ¬´–°–∞–π—Ç¬ª –∏ ¬´–ì–ª–∞–≤–Ω–∞—è¬ª —Å–ø—Ä–∞–≤–∞

**Unified Toolbar (`#cm-unified-toolbar`):**
- –ü–æ–∏—Å–∫ + –î–µ–π—Å—Ç–≤–∏—è + –∫–Ω–æ–ø–∫–∞ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ-–∫–∞—Ä—Ç–æ—á–∫–µ
- JS —Å–æ–∑–¥–∞—ë—Ç –æ–±—ë—Ä—Ç–∫—É, –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç `#toolbar` –∏ `.actions` –≤–Ω—É—Ç—Ä—å
- `form="changelist-form"` –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö `.actions` ‚Äî POST-—Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ DOM-–ø–µ—Ä–µ–Ω–æ—Å–∞
- –°–∫—Ä—ã—Ç—ã –ø–æ–¥—Å–∫–∞–∑–∫–∏: ¬´5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤¬ª, ¬´–î–µ–π—Å—Ç–≤–∏–µ:¬ª, ¬´–í—ã–±—Ä–∞–Ω–æ 0 –∏–∑ 5¬ª

**Floating blocks (—á–µ—Ä–µ–∑ JS `setProperty`):**
- `.results`, `.paginator`, `#changelist-filter` ‚Äî –±–µ–ª—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ç–µ–Ω—å—é
- `#changelist` ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—Å—Ç—Ä–æ–∫–∞: —Ñ–æ—Ä–º–∞ + —Ñ–∏–ª—å—Ç—Ä—ã)
- –û–±—Ö–æ–¥ WhiteNoise caching ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ `element.style.setProperty(prop, val, 'important')`

#### Phase 2: change_form —à–∞–±–ª–æ–Ω—ã + Design System

**–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ Caromoto (`--cm-*`)** –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–æ –≤—Å–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–º change_form —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Design System (`dashboard_admin.css`):**
- `.cm-form-grid` + `.cm-form-sidebar-col` ‚Äî –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π layout: —Ñ–æ—Ä–º–∞ + sidebar 270px
- `.cm-page-header` + `.cm-back-link` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ù–∞–∑–∞–¥¬ª
- `.cm-sidebar-card` + `.cm-sidebar-info` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –ø—Ä–∞–≤–æ–º —Å–∞–π–¥–±–∞—Ä–µ
- `.cm-status-badge-lg` ‚Äî –±–æ–ª—å—à–æ–π —Å—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂ (–∫–∞–ø—Å—É–ª–∞)
- `.cm-btn-save`, `.cm-btn-delete`, `.cm-btn-outline-action` ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
- `.cm-modal-overlay` + `.cm-modal` ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Å header/body/footer
- `.cm-photos-badge`, `.cm-gdrive-btn` ‚Äî –±–µ–π–¥–∂ —Ñ–æ—Ç–æ, –∫–Ω–æ–ø–∫–∞ Google Drive
- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ inline-—Ç–∞–±–ª–∏—Ü—ã: —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π padding, —Å–∫—Ä—ã—Ç–∞ –∫–æ–ª–æ–Ω–∫–∞ "original", —Ç–æ—á–Ω—ã–µ —à–∏—Ä–∏–Ω—ã

**–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã:**
- `car/change_form.html` ‚Äî cm-modal, cm-service-item, cm-page-header
- `container/change_form.html` ‚Äî form grid + sidebar (—Å—Ç–∞—Ç—É—Å, —Ñ–æ—Ç–æ, Google Drive)
- `newinvoice/change_form.html` ‚Äî `--cm-*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, sidebar 270px
- `autotransport/change_form.html` + CSS ‚Äî cm-page-header, `--cm-*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- 11 –ø—Ä–æ—á–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤ ‚Äî –∑–∞–º–µ–Ω–∞ hardcoded —Ü–≤–µ—Ç–æ–≤ ‚Üí CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- Responsive (@media 1100px) –∏ popup mode

#### Phase 3: UX-–ø–æ–ª–∏—Ä–æ–≤–∫–∞ —Ñ–æ—Ä–º –∏ –∏–Ω–≤–æ–π—Å–æ–≤ (14.02.2026)

**Labels –Ω–∞–¥ –ø–æ–ª—è–º–∏:** –û–±–æ–±—â–µ–Ω—ã CSS –ø—Ä–∞–≤–∏–ª–∞ —Å `#container_form` –Ω–∞ `.cm-form-main`:
- `flex-direction: column` –¥–ª—è `.flex-container:not(.form-multiline)` ‚Äî label —Å–≤–µ—Ä—Ö—É, input —Å–Ω–∏–∑—É
- `overflow: visible` –Ω–∞ `.form-row` ‚Äî fix –æ–±—Ä–µ–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ select
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è `.checkbox-row` ‚Äî —á–µ–∫–±–æ–∫—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º–∏
- `line-height: 1.4; height: auto` –¥–ª—è `select` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–æ

**–ò–Ω–≤–æ–π—Å ‚Äî attachment –≤ sidebar:**
- –£–±—Ä–∞–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ "–ò–Ω–≤–æ–π—Å" –≤ sidebar –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ —Å –∫–Ω–æ–ø–∫–æ–π "–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª"
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `os.path.isfile()` –≤ `admin_billing.py._get_extra_context()` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

**–ë–ª–æ–∫ –Ω–∞—Ü–µ–Ω–∫–∏ (car changelist):**
- Label "–û–±—â–∞—è —Å–∫—Ä—ã—Ç–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –¢–°)" ‚Äî —Å–ª–µ–≤–∞
- –°—É–º–º–∞ ‚Ç¨ ‚Äî —Å–ø—Ä–∞–≤–∞ (–≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–¥ —Å—Ç–æ–ª–±—Ü–æ–º "–ù")
- –£–±—Ä–∞–Ω —Ç–µ–∫—Å—Ç "X –¢–° —Å —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤"
- `margin: 16px 0` ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É

---

## üìä –°–¢–ê–¢–£–°–´

### –°—Ç–∞—Ç—É—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞/–¢–°

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|----------|
| `FLOATING` | –í –ø—É—Ç–∏ | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ –º–æ—Ä–µ |
| `IN_PORT` | –í –ø–æ—Ä—Ç—É | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–±—ã–ª, –æ–∂–∏–¥–∞–µ—Ç —Ä–∞–∑–≥—Ä—É–∑–∫–∏ |
| `UNLOADED` | –†–∞–∑–≥—Ä—É–∂–µ–Ω | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–∑–≥—Ä—É–∂–µ–Ω, –¢–° –Ω–∞ —Å–∫–ª–∞–¥–µ |
| `TRANSFERRED` | –ü–µ—Ä–µ–¥–∞–Ω | –¢–° –ø–µ—Ä–µ–¥–∞–Ω–æ –∫–ª–∏–µ–Ω—Ç—É |

### –°—Ç–∞—Ç—É—Å—ã –∏–Ω–≤–æ–π—Å–∞

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ |
|-----|----------|
| `DRAFT` | –ß–µ—Ä–Ω–æ–≤–∏–∫ |
| `ISSUED` | –í—ã—Å—Ç–∞–≤–ª–µ–Ω |
| `PARTIALLY_PAID` | –ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω |
| `PAID` | –û–ø–ª–∞—á–µ–Ω |
| `OVERDUE` | –ü—Ä–æ—Å—Ä–æ—á–µ–Ω |
| `CANCELLED` | –û—Ç–º–µ–Ω–µ–Ω |

---

## üõ†Ô∏è –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@176.118.198.78
cd /var/www/www-root/data/www/logist2
source .venv/bin/activate

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl restart gunicorn
systemctl restart daphne

# Celery –≤–æ—Ä–∫–µ—Ä (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ ‚Äî email)
celery -A logist2 worker --loglevel=info
# –ò–ª–∏ —á–µ—Ä–µ–∑ systemd (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–µ—Ä–≤–∏—Å celery)

# –ú–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate

# –°—Ç–∞—Ç–∏–∫–∞
python manage.py collectstatic --noinput

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ—Ç–æ
python manage.py sync_photos_gdrive --no-photos

# –ü–µ—Ä–µ—Å—á—ë—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è (–¥–Ω–∏ + —Ü–µ–Ω–∞ CarService) ‚Äî cron –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 06:00
python manage.py recalculate_storage          # —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
python manage.py recalculate_storage --verbose # —Å –¥–µ—Ç–∞–ª—è–º–∏
python manage.py recalculate_storage --all     # –≤–∫–ª—é—á–∞—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ

# –ü—Ä–∞–≤–∞ –Ω–∞ media —Ñ–∞–π–ª—ã
./fix_media_permissions.sh
```

### –õ–æ–∫–∞–ª—å–Ω–æ (PowerShell)

```powershell
# –ó–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞
.\START_ME.bat

# –î–µ–ø–ª–æ–π
.\deploy.ps1

# –ú–∏–≥—Ä–∞—Ü–∏–∏
python manage.py makemigrations
python manage.py migrate
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ù–Æ–ê–ù–°–´

### 1. –ù–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü—Ä–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ù–ï –ù–£–ñ–ù–û –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ü–µ–Ω—ã/—É—Å–ª—É–≥–∏ –¥–ª—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¢–° –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### 2. PowerShell –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç `&&` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `;`
- –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ SSH –∫–æ–º–∞–Ω–¥–∞—Ö –º–æ–∂–µ—Ç –ª–æ–º–∞—Ç—å—Å—è
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `deploy.ps1`

### 3. –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

- –õ–æ–∫–∞–ª—å–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `settings.py` (InMemory Channels).
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–≤—è–∑–∫–∞ `settings_base.py` + `settings_prod.py` (Redis Channels, ASGI –≤–∫–ª—é—á–µ–Ω).

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Django

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Å–ª—É–≥ –¢–° –Ω—É–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å prefetch –∫—ç—à:
```python
if hasattr(self, '_prefetched_objects_cache'):
    self._prefetched_objects_cache.pop('car_services', None)
```

### 4a. –ö—ç—à –æ–±—ä–µ–∫—Ç–æ–≤ —É—Å–ª—É–≥ (Django cache, —Ä–∞–Ω–µ–µ _service_obj_cache)

–ö—ç—à —É—Å–ª—É–≥ (`get_service_name()` / `get_service_short_name()` / `get_default_price()`) —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Django cache:
- –ö–ª—é—á–∏: `svc:{service_type}:{service_id}`, TTL = 300 —Å–µ–∫—É–Ω–¥
- Production: Redis (db=1), –õ–æ–∫–∞–ª—å–Ω–æ: Redis —Å fallback –Ω–∞ FileBasedCache
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª `invalidate_service_cache()` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö
- –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª—ã)

### 4b. Celery –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Celery –∑–∞–¥–∞—á–∏ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ):
- Production: Redis db=2 –∫–∞–∫ broker –∏ result backend; –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä: `celery -A logist2 worker --loglevel=info`
- –õ–æ–∫–∞–ª—å–Ω–æ: `CELERY_TASK_ALWAYS_EAGER = True` ‚Äî –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –≤–æ—Ä–∫–µ—Ä –Ω–µ –Ω—É–∂–µ–Ω
- –ü—Ä–∏ –æ—à–∏–±–∫–µ Celery ‚Äî fallback –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É

### 4c. Rate Limiting (throttling)

| Endpoint | –õ–∏–º–∏—Ç | –ö–ª–∞—Å—Å |
|----------|-------|-------|
| `track_shipment` | 20/–º–∏–Ω | `TrackShipmentThrottle` |
| `ai_chat` | 10/–º–∏–Ω | `AIChatThrottle` |

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `REST_FRAMEWORK.DEFAULT_THROTTLE_RATES` –≤ settings.

### 4d. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î –∏ –∞–¥–º–∏–Ω–∫–∏ (08.02.2026)

- **CONN_MAX_AGE = 600** –≤ `settings_base.py` ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (10 –º–∏–Ω), `connect_timeout: 10`
- **list_per_page = 50** + **show_full_result_count = False** –≤ –∫—Ä—É–ø–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∞–¥–º–∏–Ω–∫–∏:
  - `CarAdmin`, `ContainerAdmin`, `ClientAdmin`, `NewInvoiceAdmin`, `TransactionAdmin`
  - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ `SELECT COUNT(*)` –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö —É—Å–∫–æ—Ä—è–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∫—É —Å–ø–∏—Å–∫–æ–≤

### 4e. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ views –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞ (08.02.2026)

```python
# –§–∞–π–ª: core/views_website.py
@cache_page(60 * 15)   # 15 –º–∏–Ω—É—Ç ‚Äî website_home, news_list
@cache_page(60 * 60)   # 1 —á–∞—Å ‚Äî about_page, services_page, contact_page
# news_detail –ù–ï –∫—ç—à–∏—Ä—É–µ—Ç—Å—è (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á—ë—Ç—á–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤)
```

### 4f. Unit-—Ç–µ—Å—Ç—ã

–í –ø—Ä–æ–µ–∫—Ç–µ **–¥–≤–µ —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–æ–≤:**

**1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django TestCase** (`core/tests/`, 18 —Ç–µ—Å—Ç–æ–≤):
```bash
python manage.py test core.tests           # –í—Å–µ —Ç–µ—Å—Ç—ã (SQLite)
python manage.py test core.tests.test_models   # –¢–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏
python manage.py test core.tests.test_billing  # –¢–æ–ª—å–∫–æ –±–∏–ª–ª–∏–Ω–≥
```

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|---|---|---|
| `test_models.py` | 10 | Company.get_default(), Container.clean(), Car.clean(), VEHICLE_TYPE_CHOICES |
| `test_signals.py` | 3 | Thread-safe instance attrs, unloaded_status_at |
| `test_billing.py` | 5 | NewInvoice.clean() (–≤—ã—Å—Ç–∞–≤–∏—Ç–µ–ª—å/–ø–æ–ª—É—á–∞—Ç–µ–ª—å/due_date), auto-number |

**2. Legacy-—Ç–µ—Å—Ç—ã** (`run_all_tests.py`, 67 —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Ä–∞–±–æ—á–µ–π –ë–î):
```bash
.\.venv\Scripts\python.exe run_all_tests.py
```

### 5. Email —á–µ—Ä–µ–∑ Brevo

- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: 300 –ø–∏—Å–µ–º/–¥–µ–Ω—å
- SMTP: smtp-relay.brevo.com
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 6. –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã THS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–ï—Å–ª–∏ –¥–ª—è —Ç–∏–ø–∞ –¢–° –Ω–µ —É–∫–∞–∑–∞–Ω –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤ `LineTHSCoefficient`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ 1.0.

---

## üìù –¢–ò–ü–ò–ß–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

1. –£–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –í—ã–±—Ä–∞—Ç—å –ª–∏–Ω–∏—é ‚Üí —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã THS
3. –£–∫–∞–∑–∞—Ç—å —Å—É–º–º—É THS –∏ –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ (LINE/WAREHOUSE)
4. –í—ã–±—Ä–∞—Ç—å —Å–∫–ª–∞–¥ ‚Üí —É—Å–ª—É–≥–∏ —Å–∫–ª–∞–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –î–æ–±–∞–≤–∏—Ç—å –¢–° —á–µ—Ä–µ–∑ –∏–Ω–ª–∞–π–Ω ‚Üí –∫–∞–∂–¥–æ–º—É –¢–° —Å–æ–∑–¥–∞–¥—É—Ç—Å—è —É—Å–ª—É–≥–∏
6. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚Üí THS —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è –ø–æ –≤—Å–µ–º –¢–°

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã —Ä–∞–∑–≥—Ä—É–∑–∫–∏

1. –£–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
2. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚Üí –¥–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å–µ–º –¢–°
3. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—é—Ç—Å—è –ø–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è
4. –û–±–Ω–æ–≤—è—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å—ã
5. –ö–ª–∏–µ–Ω—Ç–∞–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ THS

1. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ª–∏–Ω–∏–∏
2. –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤ –∏–Ω–ª–∞–π–Ω–µ `LineTHSCoefficientInline`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏–Ω–∏—é
4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å THS"
5. THS –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –¢–° —ç—Ç–æ–π –ª–∏–Ω–∏–∏

### –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞ –∫–ª–∏–µ–Ω—Ç—É

1. –°–æ–∑–¥–∞—Ç—å NewInvoice
2. –í—ã–±—Ä–∞—Ç—å –≤—ã—Å—Ç–∞–≤–∏—Ç–µ–ª—è: Caromoto Lithuania (Company)
3. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è: –ö–ª–∏–µ–Ω—Ç
4. –î–æ–±–∞–≤–∏—Ç—å –¢–° —á–µ—Ä–µ–∑ ManyToMany
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ CarService
6. –°–∫—Ä—ã—Ç–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ –¥–æ–±–∞–≤–∏—Ç—Å—è –∫ —Ü–µ–Ω–∞–º —É—Å–ª—É–≥

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–∏—Ñ–∞ –∫–ª–∏–µ–Ω—Ç—É ‚≠ê –ù–û–í–û–ï

1. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –∫–ª–∏–µ–Ω—Ç–∞
2. –í —Ä–∞–∑–¥–µ–ª–µ "–¢–∞—Ä–∏—Ñ" –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø: FIXED –∏–ª–∏ FLEXIBLE
3. –í —Ç–∞–±–ª–∏—Ü–µ —Å—Ç–∞–≤–æ–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏: —Ç–∏–ø –¢–°, –¥–∏–∞–ø–∞–∑–æ–Ω –∫–æ–ª-–≤–∞, —Ü–µ–Ω–∞ –∑–∞ –∞–≤—Ç–æ
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–∑–¥–∞–Ω–∏–∏/–ø–µ—Ä–µ—Å—á—ë—Ç–µ THS –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–∞—Ü–µ–Ω–∫–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. `agreed_total_price` ‚Äî —ç—Ç–æ –æ–±—â–∞—è —Ü–µ–Ω–∞ –∑–∞ –∞–≤—Ç–æ (–≤—Å–µ —É—Å–ª—É–≥–∏ –∫—Ä–æ–º–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è)
6. –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —ç—Ç–æ–π —Ü–µ–Ω–æ–π –∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é = –Ω–∞—Ü–µ–Ω–∫–∞ (–ø—Ä–∏–±—ã–ª—å)

### –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–≤–æ–∑–∞ ‚≠ê –ù–û–í–û–ï

1. –°–æ–∑–¥–∞—Ç—å AutoTransport
2. –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è EORI –∫–æ–¥, —Å–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–≤–æ–∑–æ–≤ –∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π
3. –í—ã–±—Ä–∞—Ç—å –∞–≤—Ç–æ–≤–æ–∑ –∏ –≤–æ–¥–∏—Ç–µ–ª—è ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω –≤–æ–¥–∏—Ç–µ–ª—è
4. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ —á–µ—Ä–µ–∑ Select2 —Å –ø–æ–∏—Å–∫–æ–º –ø–æ VIN/–º–∞—Ä–∫–µ
5. –í—ã–±—Ä–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è, —É–∫–∞–∑–∞—Ç—å –¥–∞—Ç—ã
6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω" (FORMED)
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∏–Ω–≤–æ–π—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, —á—å–∏ –¢–° –≤ –∞–≤—Ç–æ–≤–æ–∑–µ
8. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–∞–≤–∞ –∞–≤—Ç–æ–≤–æ–∑–∞ ‚Üí –∏–Ω–≤–æ–π—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è

**API endpoints –¥–ª—è –∞–≤—Ç–æ–≤–æ–∑–æ–≤:**
- `GET /core/api/autotransport/carrier-info/<carrier_id>/` - EORI –∫–æ–¥, –∞–≤—Ç–æ–≤–æ–∑—ã, –≤–æ–¥–∏—Ç–µ–ª–∏ –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞
- `GET /core/api/autotransport/driver-phone/<driver_id>/` - —Ç–µ–ª–µ—Ñ–æ–Ω –≤–æ–¥–∏—Ç–µ–ª—è
- `GET /core/api/autotransport/border-crossings/` - —Å–ø–∏—Å–æ–∫ –≥—Ä–∞–Ω–∏—Ü –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
- `POST /core/api/autotransport/create-truck/` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ–≤–æ–∑–∞
- `POST /core/api/autotransport/create-driver/` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è

**–§–∞–π–ª—ã:**
- `core/models.py` - –º–æ–¥–µ–ª–∏ AutoTransport, CarrierTruck, CarrierDriver
- `core/models_billing.py` - —Å–≤—è–∑—å NewInvoice —Å AutoTransport
- `core/admin.py` - AutoTransportAdmin
- `core/views_autotransport.py` - API endpoints
- `core/signals.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤
- `templates/admin/core/autotransport/change_form.html` - –∫–∞—Å—Ç–æ–º–Ω—ã–π —à–∞–±–ª–æ–Ω
- `core/static/css/autotransport.css` - —Å—Ç–∏–ª–∏

### –î–∞—à–±–æ—Ä–¥ –∫–æ–º–ø–∞–Ω–∏–∏ ‚≠ê –ù–û–í–û–ï (08.02.2026)

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ KPI, –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏.

**URL:** `/admin/dashboard/` (–∏–∫–æ–Ω–∫–∞ üìä –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∫–∏)

**–°–µ—Ä–≤–∏—Å:** `core/services/dashboard_service.py` ‚Äî `DashboardService`

**–î–∏–∑–∞–π–Ω:** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–≤–µ—Ç–ª—ã–π —Å—Ç–∏–ª—å ‚Äî —Ñ–æ–Ω `#f4f2ff`, –±–µ–ª—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å subtle —Ç–µ–Ω—è–º–∏ –∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏ (`#6c5ce7`), —à—Ä–∏—Ñ—Ç Inter (Google Fonts), gradient summary cards, Boxicons (CDN) –¥–ª—è –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫ (KPI, –≥—Ä–∞—Ñ–∏–∫–∏, —Ç–∞–±–ª–∏—Ü—ã), Chart.js —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ doughnut-–≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ bar chart, hover-–∞–Ω–∏–º–∞—Ü–∏–∏ (`translateY(-3px)`), responsive layout.

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
1. **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ KPI:** –∞–≤—Ç–æ/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º, –∞–≤—Ç–æ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–ª—ã
2. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ KPI:** –±–∞–ª–∞–Ω—Å –∫–æ–º–ø–∞–Ω–∏–∏ (live), –¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã/–ø—Ä–∏–±—ã–ª—å (–º–µ—Å—è—Ü), outstanding, overdue
3. **–ì—Ä–∞—Ñ–∏–∫–∏ (Chart.js 4.x):** –¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã –∑–∞ 6 –º–µ—Å. (bar), –∞–≤—Ç–æ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (doughnut), –∏–Ω–≤–æ–π—Å—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (doughnut)
4. **–¢–∞–±–ª–∏—Ü—ã:** –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –∏–Ω–≤–æ–π—Å–æ–≤
5. **–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:** —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞/—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–∞–≤–∏–≥–∞—Ü–∏—è

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- KPI: 5 –º–∏–Ω—É—Ç
- –ì—Ä–∞—Ñ–∏–∫–∏: 30 –º–∏–Ω—É—Ç (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã: 2 –∑–∞–ø—Ä–æ—Å–∞ —Å `TruncMonth` –≤–º–µ—Å—Ç–æ 12)
- –ë–∞–ª–∞–Ω—Å –∫–æ–º–ø–∞–Ω–∏–∏: **–ù–ï –∫—ç—à–∏—Ä—É–µ—Ç—Å—è** (–≤—Å–µ–≥–¥–∞ fresh, `refresh_from_db()`)
- –ë–µ–Ω—á–º–∞—Ä–∫: —Ö–æ–ª–æ–¥–Ω—ã–π –∫—ç—à 46 –º—Å, –≥–æ—Ä—è—á–∏–π (Redis) 3 –º—Å

**–§–∞–π–ª—ã:**
- `core/services/dashboard_service.py` ‚Äî —Å–µ—Ä–≤–∏—Å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `core/views.py` ‚Äî `company_dashboard()` –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤ `DashboardService`
- `templates/admin/company_dashboard.html` ‚Äî —à–∞–±–ª–æ–Ω —Å Chart.js
- `templates/admin/base_site.html` ‚Äî –∏–∫–æ–Ω–∫–∞ üìä –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- `logist2/urls.py` ‚Äî URL `/admin/dashboard/`

---

## üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ï–ñ–î–£ –ú–ê–®–ò–ù–ê–ú–ò

–ü—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 3 –º–∞—à–∏–Ω–∞—Ö: **VPS** (production), **—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π –ü–ö**, **–Ω–æ—É—Ç–±—É–∫**.

### –ü—Ä–∏–Ω—Ü–∏–ø —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **–ö–æ–¥:** —á–µ—Ä–µ–∑ git (`git push` / `git pull`)
- **–ë–î:** —á–µ—Ä–µ–∑ `pg_dump` (VPS) ‚Üí `scp` ‚Üí `pg_restore` (–ª–æ–∫–∞–ª—å–Ω–æ)
- **Media:** –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è (—Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ VPS)

### –°–∫—Ä–∏–ø—Ç—ã
- `vps_push.sh` ‚Äî –Ω–∞ VPS: –∫–æ–º–º–∏—Ç–∏—Ç –∏ –ø—É—à–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `sync_from_vps.ps1` ‚Äî –Ω–∞ –ü–ö/–Ω–æ—É—Ç–±—É–∫–µ: —Ç—è–Ω–µ—Ç –∫–æ–¥ + –ë–î —Å VPS (—Ñ–ª–∞–≥–∏ `-NoDB`, `-DBOnly`)

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è 4 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ‚Äî –≤ `SYNC_GUIDE.md`:
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–µ—Å–∫—Ç–æ–ø–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ—É—Ç–±—É–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ë–î

---

## ‚ö° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø, –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –¢–ï–°–¢–´ (08.02.2026)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ print()

–í—Å–µ `print()` –≤ —Ä–∞–±–æ—á–∏—Ö —Ñ–∞–π–ª–∞—Ö –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `logging.logger`:
- **debug** ‚Äî —à—Ç–∞—Ç–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥, –ø–µ—Ä–µ—Å—á—ë—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è, pre_save)
- **error** ‚Äî –æ—à–∏–±–∫–∏ (–ø–µ—Ä–µ—Å—á—ë—Ç —Ü–µ–Ω—ã, —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥, —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥)
- **warning** ‚Äî "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ" (—É—Å–ª—É–≥–∞ —Å ID –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)

–§–∞–π–ª—ã –±–µ–∑ print(): `signals.py`, `models.py`, `admin/car.py`, `admin/partners.py`, `forms.py`.
–ù–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã: –º–∏–≥—Ä–∞—Ü–∏–∏. Backup-—Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã (08.02.2026).

### –ò–Ω–¥–µ–∫—Å—ã –ë–î (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

–í—Å–µ —á–∞—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º—ã–µ –ø–æ–ª—è —É–∂–µ –∏–º–µ—é—Ç –∏–Ω–¥–µ–∫—Å—ã:
- `Container`: status, client+status, warehouse+status, line, eta, unload_date
- `Car`: vin, status, client+status, warehouse+status, line, carrier, container, unload_date, transfer_date
- `CarService`: car+service_type, service_type+service_id, car

### –ö—ç—à –æ–±—ä–µ–∫—Ç–æ–≤ —É—Å–ª—É–≥ (Django cache, —Ä–∞–Ω–µ–µ class-level dict)

```python
# –§–∞–π–ª: core/models.py ‚Äî –∫–ª–∞—Å—Å CarService
# –ö—ç—à –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –Ω–∞ Django cache (Redis –Ω–∞ production –∏ –ª–æ–∫–∞–ª—å–Ω–æ, fallback –Ω–∞ FileBasedCache)

from django.core.cache import cache

SERVICE_MODEL_MAP = {
    'LINE': LineService,
    'CARRIER': CarrierService,
    'WAREHOUSE': WarehouseService,
    'COMPANY': CompanyService,
}

def _get_service_obj(self):
    """–ü–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç —É—Å–ª—É–≥–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Django cache (TTL 300—Å)"""
    cache_key = f"svc:{self.service_type}:{self.service_id}"
    obj = cache.get(cache_key)
    if obj is None:
        model_class = CarService.SERVICE_MODEL_MAP.get(self.service_type)
        if model_class:
            obj = model_class.objects.get(id=self.service_id)
            cache.set(cache_key, obj, 300)
    return obj

# –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è: —Å–∏–≥–Ω–∞–ª invalidate_service_cache() –≤ core/signals.py
# –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ post_save/post_delete –≤—Å–µ—Ö 4 –º–æ–¥–µ–ª–µ–π —É—Å–ª—É–≥
```

### –£—Ç–∏–ª–∏—Ç–∞ round_up_to_5

```python
# –§–∞–π–ª: core/utils.py
def round_up_to_5(value):
    """–û–∫—Ä—É–≥–ª—è–µ—Ç Decimal –≤–≤–µ—Ä—Ö —Å —à–∞–≥–æ–º 5 EUR (–±–µ–∑ float)"""
    remainder = value % 5
    if remainder == 0:
        return value
    return value + (5 - remainder)
```

### Unit-—Ç–µ—Å—Ç—ã

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django TestCase (SQLite, –±—ã—Å—Ç—Ä—ã–µ):
python manage.py test core.tests                          # –í—Å–µ —Ç–µ—Å—Ç—ã (18)
python manage.py test core.tests.test_models              # –ú–æ–¥–µ–ª–∏
python manage.py test core.tests.test_signals             # –°–∏–≥–Ω–∞–ª—ã
python manage.py test core.tests.test_billing             # –ë–∏–ª–ª–∏–Ω–≥

# Legacy-—Ç–µ—Å—Ç—ã (—Ä–∞–±–æ—á–∞—è –ë–î, atomic rollback):
.\.venv\Scripts\python.exe run_all_tests.py               # 67 —Ç–µ—Å—Ç–æ–≤
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ admin/ –ø–∞–∫–µ—Ç–∞

```
core/admin/
‚îú‚îÄ‚îÄ __init__.py     # –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Django Admin)
‚îú‚îÄ‚îÄ inlines.py      # CarInline, LineTHSCoefficientInline –∏ –¥—Ä. (ContainerPhotoInline —É–¥–∞–ª—ë–Ω ‚Äî —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ AJAX-–≥–∞–ª–µ—Ä–µ—é)
‚îú‚îÄ‚îÄ container.py    # ContainerAdmin (save_model, save_formset, THS –ª–æ–≥–∏–∫–∞)
‚îú‚îÄ‚îÄ car.py          # CarAdmin (total_price_display, services_summary, markup_display)
‚îî‚îÄ‚îÄ partners.py     # WarehouseAdmin, ClientAdmin, CompanyAdmin, LineAdmin, CarrierAdmin, AutoTransportAdmin
```

---

## üè¶ –í–ù–ï–®–ù–ò–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–ò (Revolut, Site.pro –∏ –¥—Ä.)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ API. –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω Revolut Business.

```
core/models_banking.py          # BankConnection, BankAccount, BankTransaction
core/services/revolut_service.py # RevolutService ‚Äî API-–∫–ª–∏–µ–Ω—Ç
core/admin_banking.py           # Django Admin –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π
core/management/commands/
‚îú‚îÄ‚îÄ setup_revolut.py            # –ü–æ–º–æ—â–Ω–∏–∫ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îî‚îÄ‚îÄ sync_bank_accounts.py       # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è cron-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

### –ú–æ–¥–µ–ª–∏

- **BankConnection** ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–Ω–∫—É (—Ç–∏–ø, –∫–æ–º–ø–∞–Ω–∏—è, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã, —Å—Ç–∞—Ç—É—Å)
- **BankAccount** ‚Äî –∫—ç—à –¥–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ (external_id, –±–∞–ª–∞–Ω—Å, –≤–∞–ª—é—Ç–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- **BankTransaction** ‚Äî –∫—ç—à –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (—Ç–∏–ø, —Å—É–º–º–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç, –æ–ø–∏—Å–∞–Ω–∏–µ) + reconciliation –ø–æ–ª—è (matched_transaction, matched_invoice)

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

–í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (client_id, refresh_token, access_token, jwt_assertion) –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã Fernet.
–ö–ª—é—á –±–µ—Ä—ë—Ç—Å—è –∏–∑ `ENCRYPTION_KEY` (env), –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω ‚Äî fallback –Ω–∞ `SECRET_KEY`.
**–í–ê–ñ–ù–û:** –Ω–µ –º–µ–Ω—è–π—Ç–µ ENCRYPTION_KEY –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å—Ç–∞–Ω—É—Ç –Ω–µ—á–∏—Ç–∞–µ–º—ã–º–∏.
–î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Python property:

```python
conn.client_id = "plain_text"     # —à–∏—Ñ—Ä—É–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ _client_id
value = conn.client_id             # —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –∏–∑ _client_id
```

### Revolut API

- **Base URL:** `https://b2b.revolut.com` (production), `https://sandbox-b2b.revolut.com` (sandbox)
- **Auth:** JWT + refresh_token ‚Üí access_token (40 –º–∏–Ω, –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- **Endpoints:** `/api/1.0/accounts`, `/api/1.0/transactions`
- **Cron:** `*/15 * * * *` ‚Äî –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `sync_bank_accounts`
- **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–∞ VPS:** `/var/www/www-root/data/www/logist2/certs/`

### –î–∞—à–±–æ—Ä–¥

- –°–µ–∫—Ü–∏—è "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞" ‚Äî KPI-–∫–∞—Ä—Ç–æ—á–∫–∏ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—á—ë—Ç—É
- –¢–∞–±–ª–∏—Ü–∞ "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏" ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ –±–∞–Ω–∫–∞
- –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç (CACHE_TIMEOUTS['short'])

### Site.pro (b1.lt) Accounting API

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω–≤–æ–π—Å–æ–≤ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É site.pro (–õ–∏—Ç–≤–∞).

```
core/models_accounting.py              # SiteProConnection, SiteProInvoiceSync
core/services/sitepro_service.py       # SiteProService ‚Äî API-–∫–ª–∏–µ–Ω—Ç
core/admin_accounting.py               # Django Admin –¥–ª—è site.pro
core/management/commands/setup_sitepro.py  # –ü–æ–º–æ—â–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

- **API Base URL:** `https://site.pro/My-Accounting/api`
- **Auth:** –∑–∞–≥–æ–ª–æ–≤–æ–∫ `B1-Api-Key` (–ù–ï bearer token)
- **Endpoints:**
  - `/warehouse/sales/create` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏
  - `/warehouse/sale-items/create` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂–∏
  - `/clients/create`, `/clients/list` ‚Äî –∫–ª–∏–µ–Ω—Ç—ã
  - `/warehouse/invoices/get-sale` ‚Äî PDF –∏–Ω–≤–æ–π—Å–∞
  - `/reference-book/vat-rates/list`, `/reference-book/currencies/list`, `/reference-book/series/list` ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
  - `/bank/sale-invoice/payment` ‚Äî –∑–∞–ø–∏—Å—å –æ–ø–ª–∞—Ç—ã
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** `python manage.py setup_sitepro`
- **–ê–≤—Ç–æ-push:** –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–≤–æ–π—Å–∞ –Ω–∞ ISSUED (–µ—Å–ª–∏ `auto_push_on_issue` –≤–∫–ª—é—á—ë–Ω)
- **–ö–ª—é—á–∏:** –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã Fernet –≤ `_api_key`, `_private_key` (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Revolut)
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** `0110_sitepro_integration.py`, `0111_add_sitepro_api_keys.py`
- **–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (—Ñ–µ–≤—Ä–∞–ª—å 2026):** API –∫–ª—é—á –≤–∞–ª–∏–¥–µ–Ω, –Ω–æ –∑–∞–º–æ—Ä–æ–∂–µ–Ω (–Ω—É–∂–Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å API-–ø–ª–∞–Ω)

### –£—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ (Expense Tracking)

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —É—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤ –∏–∑ Django Admin:
- **ExpenseCategory** ‚Äî 7 –±–∞–∑–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–õ–æ–≥–∏—Å—Ç–∏–∫–∞, –ê—Ä–µ–Ω–¥–∞, –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ, –ó–∞—Ä–ø–ª–∞—Ç—ã, –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ù–∞–ª–æ–≥–∏, –ü—Ä–æ—á–∏–µ)
- **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞** ‚Äî computed property `direction`: OUTGOING/INCOMING/INTERNAL
- **–ê–≤—Ç–æ-–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî `pre_save` —Å–∏–≥–Ω–∞–ª: –µ—Å–ª–∏ –≤—ã—Å—Ç–∞–≤–∏—Ç–µ–ª—å —Å–∫–ª–∞–¥/–ª–∏–Ω–∏—è/–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫ ‚Üí "–õ–æ–≥–∏—Å—Ç–∏–∫–∞"
- **P&L –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ** ‚Äî doughnut-–≥—Ä–∞—Ñ–∏–∫ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤" + —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **–í–ª–æ–∂–µ–Ω–∏—è** ‚Äî `attachment` FileField –Ω–∞ NewInvoice –∏ Transaction (PDF/—Ñ–æ—Ç–æ)

### Invoice-Bank Reconciliation

–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤ —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏:
- `NewInvoice.external_number` ‚Äî –Ω–æ–º–µ—Ä —Å—á—ë—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ (–¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤—ã–ø–∏—Å–∫–∞—Ö)
- `BankTransaction.matched_invoice` / `matched_transaction` ‚Äî FK-–ø—Ä–∏–≤—è–∑–∫–∏
- `BankTransaction.reconciliation_skipped` ‚Äî –ø–æ–º–µ—Ç–∫–∞ "–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏" (fee/exchange/tax)
- `BankTransaction.is_reconciled` ‚Äî computed property (matched –ò–õ–ò skipped)
- –§–∏–ª—å—Ç—Ä: "–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã" / "–ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏" / "–ù–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã" –≤ BankTransactionAdmin
- `BillingService.pay_invoice(bank_transaction_id=...)` ‚Äî –∞–≤—Ç–æ-–ø—Ä–∏–≤—è–∑–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ
- `BillingService.auto_reconcile_bank_transactions()` ‚Äî –∞–≤—Ç–æ-—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ external_number (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ sync_bank_accounts)
- –ê–≤—Ç–æ-–ø—Ä–æ–ø—É—Å–∫: –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Revolut —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ fee/exchange/tax –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–µ –ø—Ä–∏–≤—è–∑–∫–∏

### –ê–≤—Ç–æ–≤–æ–∑—ã (AutoTransport) ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–ê–≤—Ç–æ—Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ:**
- –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ–≤–æ–∑–∞ –Ω–∞ LOADED/IN_TRANSIT/DELIVERED ‚Üí –≤—Å–µ –∞–≤—Ç–æ ‚Üí TRANSFERRED + –¥–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏
- –°–∏–≥–Ω–∞–ª `autotransport_post_save` –≤ `core/signals.py`, —Ñ—É–Ω–∫—Ü–∏—è `_mark_cars_as_transferred()`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–π –¥–∞—Ç—ã —á–µ—Ä–µ–∑ `_transfer_date_override`

**–ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∂–µ–Ω" + –ø–æ–ª–µ –¥–∞—Ç—ã:**
- AJAX-–∫–Ω–æ–ø–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–≤–æ–∑–æ–≤ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ FORMED/DRAFT
- Endpoint `<pk>/mark-loaded/` –≤ `AutoTransportAdmin.get_urls()`
- –®–∞–±–ª–æ–Ω `templates/admin/core/autotransport/change_list.html`

**–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∏–Ω–≤–æ–π—Å–æ–≤:**
- –°–µ—Ä–∞—è (–Ω–µ—Ç –∏–Ω–≤–æ–π—Å–æ–≤), –∫—Ä–∞—Å–Ω–∞—è (–Ω–µ –æ–ø–ª–∞—á–µ–Ω—ã), –∂—ë–ª—Ç–∞—è (—á–∞—Å—Ç–∏—á–Ω–æ), –∑–µ–ª—ë–Ω–∞—è (–æ–ø–ª–∞—á–µ–Ω—ã)
- –ì—Ä–∞–¥–∏–µ–Ω—Ç –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω–≤–æ–π—Å–æ–≤

**–°–∫—Ä—ã—Ç–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö:** `get_changelist_instance` + `get_queryset` (—Ç–æ–ª—å–∫–æ –¥–ª—è changelist, –Ω–µ –¥–ª—è change_form)

**Mass action:** "üöõ –ü—Ä–∏—Å–≤–æ–∏—Ç—å —Å—Ç–∞—Ç—É—Å –î–æ—Å—Ç–∞–≤–ª–µ–Ω"

**–ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –∞–≤—Ç–æ:** Select2 —Ç–µ–≥–∏ ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–≤—Ç–æ (target="_blank"); VIN –≤ –ø–æ–∑–∏—Ü–∏—è—Ö –∏–Ω–≤–æ–π—Å–∞ —Ç–æ–∂–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π

### –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ –∏–∑ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–î–ª—è –ø–æ–∫—É–ø–æ–∫ –ø–æ –∫–∞—Ä—Ç–µ (—Ç–æ–ø–ª–∏–≤–æ, –∫–∞–Ω—Ü—Ç–æ–≤–∞—Ä—ã) –±–µ–∑ —Å—á—ë—Ç–∞ –æ—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞:
- –ö–Ω–æ–ø–∫–∞ "üí∞ –†–∞—Å—Ö–æ–¥" –≤ —Å–ø–∏—Å–∫–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Üí –∫–∞—Å—Ç–æ–º–Ω–∞—è —Ñ–æ—Ä–º–∞
- –§–æ—Ä–º–∞: –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ), –∫–æ–º–ø–∞–Ω–∏—è (–∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä –ø–æ counterparty_name), –æ–ø–∏—Å–∞–Ω–∏–µ
- –ê–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–µ NewInvoice (–≤—Ö–æ–¥—è—â–∏–π, PAID) + InvoiceItem + –ø—Ä–∏–≤—è–∑–∫–∞ –∫ BankTransaction
- Mass action "–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã (–º–∞—Å—Å–æ–≤–æ)" ‚Äî –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –≤—ã–±–æ—Ä–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- URL: `admin/core/banktransaction/<pk>/create-expense/`
- –®–∞–±–ª–æ–Ω—ã: `templates/admin/core/banktransaction/create_expense.html`, `create_expenses_bulk.html`

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–∞–π–¥–±–∞—Ä–∞ –∞–¥–º–∏–Ω–∫–∏ (LogistAdminSite)

`logist2/admin_site.py` ‚Üí `LogistAdminSite` (–Ω–∞—Å–ª–µ–¥—É–µ—Ç `AdminSite`):
- –õ–æ–≥–∏—Å—Ç–∏–∫–∞ (Car, Container, AutoTransport ‚Äî —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–¥–∞—á–µ–π –∞–≤—Ç–æ, —Ü–≤–µ—Ç–Ω—ã–º–∏ –∏–Ω–≤–æ–π—Å–∞–º–∏)
- –ü–∞—Ä—Ç–Ω—ë—Ä—ã (Warehouse, Client, Company, Line, Carrier)
- –§–∏–Ω–∞–Ω—Å—ã (NewInvoice, Transaction, InvoiceItem, ExpenseCategory)
- –ë–∞–Ω–∫–∏–Ω–≥ (BankConnection, BankAccount, BankTransaction)
- –°–∞–π—Ç (ClientUser, AIChat, NewsPost, CarPhoto, ContainerPhoto)
- Site.pro (SiteProConnection, SiteProInvoiceSync)

Monkey-patch –≤ `logist2/__init__.py` –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.

**–ö–∞—Å—Ç–æ–º–Ω—ã–π layout (14.02.2026):** Phase 1 ‚Äî sidebar + topbar –≤ `base_site.html`, unified toolbar –Ω–∞ changelist —á–µ—Ä–µ–∑ `change_list.html` + JS DOM-–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏. Phase 2 ‚Äî form grid + sidebar –¥–ª—è change_form, –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏–Ω–ª–∞–π–Ω—ã, –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ `--cm-*` CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã. Phase 3 ‚Äî UX-–ø–æ–ª–∏—Ä–æ–≤–∫–∞: labels –Ω–∞–¥ –ø–æ–ª—è–º–∏, fix select clipping, –∏–Ω–≤–æ–π—Å attachment –≤ sidebar, –±–ª–æ–∫ –Ω–∞—Ü–µ–Ω–∫–∏ redesign.

### CSP (Content Security Policy)

–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ `logist2/settings_security.py`. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö CDN ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–∏—Ä–µ–∫—Ç–∏–≤—É (style-src, font-src, script-src).

–¢–µ–∫—É—â–∏–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã:
- `fonts.googleapis.com`, `fonts.gstatic.com` ‚Äî Google Fonts
- `cdn.jsdelivr.net` ‚Äî Chart.js
- `cdnjs.cloudflare.com` ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `unpkg.com` ‚Äî Boxicons

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- `AI_PROJECT_CONTEXT.md` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI —Å –¥–µ—Ç–∞–ª—è–º–∏ –¥–µ–ø–ª–æ—è
- `LOGIST2_PROGRESS_REPORT.md` ‚Äî –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ
- `SYNC_GUIDE.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–∞—à–∏–Ω–∞–º–∏
- `CREDENTIALS.md` ‚Äî –ø–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã (–Ω–µ –≤ git)

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**
