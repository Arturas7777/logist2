# üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ VPS

## ‚ö° TL;DR (–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

–ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –º–∏–Ω–∏–∞—Ç—é—Ä—ã –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–∞.

**–†–µ—à–µ–Ω–∏–µ: –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ VPS:**

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ VPS
ssh user@your-vps-ip

# 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /var/www/caromoto-lt

# 3. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
git pull origin master

# 4. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python manage.py check_photo_environment

# 6. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ —Å Pillow, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
sudo apt-get update
sudo apt-get install -y libjpeg-dev zlib1g-dev libpng-dev
pip install --upgrade --force-reinstall Pillow

# 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º/—Å–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ —Å –ø—Ä–∞–≤–∞–º–∏
sudo mkdir -p media/container_photos/thumbnails
sudo chown -R www-data:www-data media/
sudo chmod -R 775 media/container_photos/

# 8. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–∞—Ç—é—Ä—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–æ—Ç–æ
python manage.py regenerate_thumbnails

# 9. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
sudo systemctl restart caromoto-lt

# 10. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
sudo tail -f /var/log/nginx/caromoto-lt-error.log
```

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –º–µ—Ç–æ–¥–µ `ContainerPhoto.save()`
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä—Ö–∏–≤–æ–≤** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ `extract_photos()`
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤** - –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã (__MACOSX, .DS_Store)

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python manage.py check_photo_environment

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo grep -i "containerphoto" /var/log/caromoto-lt/app.log | tail -50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
ls -la media/container_photos/
ls -la media/container_photos/thumbnails/

# –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
sudo -u www-data touch media/container_photos/thumbnails/test.txt
sudo -u www-data rm media/container_photos/thumbnails/test.txt
```

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `core/models_website.py` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `core/management/commands/regenerate_thumbnails.py` - –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
- `core/management/commands/check_photo_environment.py` - –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞
- `CONTAINER_PHOTOS_FIX.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `CHANGELOG.md` - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥:
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –∞—Ä—Ö–∏–≤—ã –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ú–∏–Ω–∏–∞—Ç—é—Ä—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –°—Ç–∞—Ä—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ª—É—á–∞—Ç –º–∏–Ω–∏–∞—Ç—é—Ä—ã
- ‚úÖ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç–µ
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –±—É–¥—É—Ç –≤ –ª–æ–≥–∞—Ö

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –í–°–ï –º–∏–Ω–∏–∞—Ç—é—Ä—ã (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ)
python manage.py regenerate_thumbnails --force

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
python manage.py regenerate_thumbnails --container CONTAINER_NUMBER

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
python manage.py shell
>>> from core.models_website import ContainerPhoto
>>> total = ContainerPhoto.objects.count()
>>> without_thumbs = ContainerPhoto.objects.filter(thumbnail='').count()
>>> print(f"–í—Å–µ–≥–æ: {total}, –±–µ–∑ –º–∏–Ω–∏–∞—Ç—é—Ä: {without_thumbs}")
```

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `CONTAINER_PHOTOS_FIX.md`

---

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ:
1. –ù–æ–≤—ã–µ –∞—Ä—Ö–∏–≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. –ú–∏–Ω–∏–∞—Ç—é—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ –∏ –Ω–∞ —Å–∞–π—Ç–µ
3. –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä

