{% extends "admin/change_form.html" %}
{% load static i18n %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'css/logist2_custom_admin.css' %}">
{% endblock %}

{% block content %}
  <div id="container_form">
    <div class="container-details">
      <p>
        <span class="status-highlight"
      style="background-color: {{ original.get_status_color }}; color: white; padding: 4px 8px; border-radius: 5px;">
  {{ original.get_status_display }}
</span>
        {% if original.notes %}
          <span style="margin-left: 20px; width: 1000px; display: inline-block;">
            {{ original.notes }}
          </span>
        {% endif %}
      </p>
      
      {% if original.pk %}
      <div style="margin-top: 10px;">
        <button type="button" id="sync-gdrive-btn" class="button" style="background-color: #4285f4; color: white;">
          üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å Google Drive
        </button>
        <span id="sync-status" style="margin-left: 10px;"></span>
      </div>
      
      <script>
      document.getElementById('sync-gdrive-btn').addEventListener('click', function() {
        const btn = this;
        const status = document.getElementById('sync-status');
        
        btn.disabled = true;
        btn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
        status.textContent = '';
        
        fetch('{% url "core:sync_container_photos_gdrive" original.pk %}', {
          method: 'POST',
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            status.innerHTML = '<span style="color: green;">‚úì ' + data.message + '</span>';
            setTimeout(() => location.reload(), 1500);
          } else {
            status.innerHTML = '<span style="color: red;">‚úó ' + data.error + '</span>';
          }
          btn.disabled = false;
          btn.textContent = 'üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å Google Drive';
        })
        .catch(error => {
          status.innerHTML = '<span style="color: red;">‚úó –û—à–∏–±–∫–∞: ' + error + '</span>';
          btn.disabled = false;
          btn.textContent = 'üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å Google Drive';
        });
      });
      </script>
      {% endif %}
    </div>
    {{ block.super }}
  </div>
{% endblock %}
