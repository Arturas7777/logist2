{% extends "admin/base_site.html" %}
{% load static i18n %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div style="padding: 20px;">
    <h1>üöó –ê–≤—Ç–æ –Ω–∞ —Å–∫–ª–∞–¥–µ - {{ client.name }}</h1>
    
    <div style="margin: 20px 0; display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="{% url 'admin:core_client_change' client.pk %}" 
           style="background: #6c757d; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none;">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–ª–∏–µ–Ω—Ç—É
        </a>
        <button onclick="copyToClipboard()" 
                style="background: #28a745; color: white; padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px;">
            üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫
        </button>
    </div>
    
    {% if total_count == 0 %}
        <div style="padding: 40px; text-align: center; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
            <p style="font-size: 18px; color: #6c757d;">–£ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç –∞–≤—Ç–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</p>
            <p style="color: #999;">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–†–∞–∑–≥—Ä—É–∂–µ–Ω"</p>
        </div>
    {% else %}
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
            <div style="font-size: 2em; font-weight: bold;">{{ total_count }} –∞–≤—Ç–æ</div>
            <div style="opacity: 0.9;">–Ω–∞ —Å–∫–ª–∞–¥–µ</div>
        </div>
        
        {% for wh_name, wh_cars in warehouses_data.items %}
        <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; margin-bottom: 20px; overflow: hidden;">
            <div style="background: #f8f9fa; padding: 15px; border-bottom: 1px solid #dee2e6;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    üìç {{ wh_name }}
                    <span style="background: #007bff; color: white; padding: 3px 10px; border-radius: 12px; font-size: 14px;">
                        {{ wh_cars|length }} –∞–≤—Ç–æ
                    </span>
                </h3>
            </div>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">VIN</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">–ú–∞—Ä–∫–∞</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">–ì–æ–¥</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">–î–∞—Ç–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">–î–Ω–µ–π –Ω–∞ —Å–∫–ª–∞–¥–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for car in wh_cars %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 12px;">
                            <a href="{% url 'admin:core_car_change' car.pk %}" style="font-family: monospace; font-weight: bold;">
                                {{ car.vin }}
                            </a>
                        </td>
                        <td style="padding: 12px;">{{ car.brand }}</td>
                        <td style="padding: 12px;">{{ car.year }}</td>
                        <td style="padding: 12px;">
                            {% if car.container %}
                                <a href="{% url 'admin:core_container_change' car.container.pk %}">{{ car.container.number }}</a>
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                        <td style="padding: 12px;">
                            {% if car.unload_date %}
                                {{ car.unload_date|date:"d.m.Y" }}
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                        <td style="padding: 12px;">
                            {% if car.days %}
                                <span style="{% if car.days > 14 %}color: #dc3545;{% elif car.days > 7 %}color: #ffc107;{% else %}color: #28a745;{% endif %} font-weight: bold;">
                                    {{ car.days }} –¥–Ω.
                                </span>
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
    {% endif %}
</div>

<!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
<textarea id="copyText" style="position: absolute; left: -9999px;">{{ text_for_copy }}</textarea>

<script>
function copyToClipboard() {
    var copyText = document.getElementById("copyText");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    
    try {
        navigator.clipboard.writeText(copyText.value).then(function() {
            alert('‚úÖ –°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }).catch(function() {
            // Fallback
            document.execCommand("copy");
            alert('‚úÖ –°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        });
    } catch (err) {
        document.execCommand("copy");
        alert('‚úÖ –°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }
}
</script>
{% endblock %}

